%%%% FILE: D:\projects\oerms\oerms-frontend\components\common\error-boundary.tsx %%%%
// components/common/error-boundary.tsx
'use client';

import React, { Component, ReactNode } from 'react';
import { Button } from '@/components/ui/Button';
import { AlertTriangle, RefreshCw } from 'lucide-react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
  onError?: (error: Error, errorInfo: React.ErrorInfo) => void;
}

interface State {
  hasError: boolean;
  error?: Error;
  errorInfo?: React.ErrorInfo;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error Boundary caught an error:', error, errorInfo);

    this.setState({
      error,
      errorInfo
    });

    // Call optional error handler
    this.props.onError?.(error, errorInfo);
  }

  handleRetry = () => {
    this.setState({ hasError: false, error: undefined, errorInfo: undefined });
  };

  render() {
    if (this.state.hasError) {
      // Custom fallback UI
      if (this.props.fallback) {
        return this.props.fallback;
      }

      // Default error UI
      return (
        <div className="min-h-[400px] flex items-center justify-center p-6">
          <div className="max-w-md w-full bg-white rounded-lg border border-red-200 p-6 text-center shadow-lg">
            <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <AlertTriangle className="w-8 h-8 text-red-600" />
            </div>

            <h2 className="text-xl font-semibold text-gray-900 mb-2">
              Something went wrong
            </h2>

            <p className="text-gray-600 mb-6">
              An unexpected error occurred. Please try refreshing the page or contact support if the problem persists.
            </p>

            <div className="flex gap-3 justify-center">
              <Button onClick={this.handleRetry} className="flex items-center gap-2">
                <RefreshCw className="w-4 h-4" />
                Try Again
              </Button>

              <Button
                variant="secondary"
                onClick={() => window.location.reload()}
              >
                Refresh Page
              </Button>
            </div>

            {/* Development error details */}
            {process.env.NODE_ENV === 'development' && this.state.error && (
              <details className="mt-6 text-left">
                <summary className="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900">
                  Error Details (Development Only)
                </summary>
                <div className="mt-2 p-3 bg-gray-100 rounded text-xs font-mono text-gray-800 overflow-auto max-h-32">
                  <div className="font-semibold mb-1">Error:</div>
                  <div className="mb-2">{this.state.error.message}</div>
                  {this.state.errorInfo && (
                    <>
                      <div className="font-semibold mb-1">Component Stack:</div>
                      <pre className="whitespace-pre-wrap">{this.state.errorInfo.componentStack}</pre>
                    </>
                  )}
                </div>
              </details>
            )}
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

// Hook for using error boundary in functional components
export function useErrorHandler() {
  return (error: Error, errorInfo: React.ErrorInfo) => {
    console.error('Error caught by hook:', error, errorInfo);

    // You could send this to an error reporting service
    // reportError(error, errorInfo);
  };
}

// Wrapper component for easier usage
interface ErrorBoundaryWrapperProps {
  children: ReactNode;
  showDetails?: boolean;
}

export function ErrorBoundaryWrapper({
  children,
  showDetails = false
}: ErrorBoundaryWrapperProps) {
  const handleError = useErrorHandler();

  return (
    <ErrorBoundary
      onError={handleError}
      fallback={
        <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
          <div className="flex items-center gap-3">
            <AlertTriangle className="w-5 h-5 text-red-600" />
            <div>
              <h3 className="font-medium text-red-800">Application Error</h3>
              <p className="text-sm text-red-700 mt-1">
                Something went wrong. The page has been reloaded.
              </p>
            </div>
          </div>
          {showDetails && (
            <Button
              size="sm"
              variant="secondary"
              className="mt-3"
              onClick={() => window.location.reload()}
            >
              Reload Page
            </Button>
          )}
        </div>
      }
    >
      {children}
    </ErrorBoundary>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\common\loading.tsx %%%%
// components/common/loading.tsx
'use client';

import React from 'react';

interface LoadingProps {
  size?: 'sm' | 'md' | 'lg';
  text?: string;
  className?: string;
}

export function Loading({ size = 'md', text, className = '' }: LoadingProps) {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-8 h-8',
    lg: 'w-12 h-12'
  };

  return (
    <div className={`flex flex-col items-center justify-center space-y-2 ${className}`}>
      <div
        className={`${sizeClasses[size]} border-2 border-blue-600 border-t-transparent rounded-full animate-spin`}
      />
      {text && (
        <p className="text-sm text-gray-600">{text}</p>
      )}
    </div>
  );
}

interface LoadingScreenProps {
  message?: string;
  className?: string;
}

export function LoadingScreen({ message = 'Loading...', className = '' }: LoadingScreenProps) {
  return (
    <div className={`min-h-screen flex items-center justify-center bg-gray-50 ${className}`}>
      <div className="text-center space-y-4">
        <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto" />
        <p className="text-lg text-gray-700">{message}</p>
      </div>
    </div>
  );
}

interface SkeletonProps {
  className?: string;
}

export function Skeleton({ className = '' }: SkeletonProps) {
  return (
    <div className={`animate-pulse bg-gray-200 rounded ${className}`} />
  );
}

// Card skeleton for content loading
export function CardSkeleton() {
  return (
    <div className="bg-white rounded-lg border border-gray-200 p-6 space-y-4">
      <div className="flex items-center space-x-4">
        <Skeleton className="w-12 h-12 rounded-full" />
        <div className="space-y-2">
          <Skeleton className="w-32 h-4" />
          <Skeleton className="w-24 h-3" />
        </div>
      </div>
      <div className="space-y-2">
        <Skeleton className="w-full h-4" />
        <Skeleton className="w-3/4 h-4" />
      </div>
    </div>
  );
}

// Table skeleton
export function TableSkeleton({ rows = 5, columns = 4 }: { rows?: number; columns?: number }) {
  return (
    <div className="space-y-3">
      {/* Header */}
      <div className="flex space-x-4">
        {Array.from({ length: columns }).map((_, i) => (
          <Skeleton key={i} className="flex-1 h-4" />
        ))}
      </div>
      {/* Rows */}
      {Array.from({ length: rows }).map((_, rowIndex) => (
        <div key={rowIndex} className="flex space-x-4">
          {Array.from({ length: columns }).map((_, colIndex) => (
            <Skeleton key={colIndex} className="flex-1 h-3" />
          ))}
        </div>
      ))}
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\exam\ExamTimer.tsx %%%%
'use client';

import { useState, useEffect, useCallback } from 'react';

interface ExamTimerProps {
    /** Duration in minutes */
    durationMinutes: number;
    /** Start time ISO string */
    startTime: string;
    /** Called when timer reaches zero */
    onTimeUp?: () => void;
    /** Called every second with remaining seconds */
    onTick?: (remainingSeconds: number) => void;
    /** Optional class name */
    className?: string;
}

export function ExamTimer({
    durationMinutes,
    startTime,
    onTimeUp,
    onTick,
    className = '',
}: ExamTimerProps) {
    const [remainingSeconds, setRemainingSeconds] = useState(() => {
        const startMs = new Date(startTime).getTime();
        const endMs = startMs + durationMinutes * 60 * 1000;
        const nowMs = Date.now();
        return Math.max(0, Math.floor((endMs - nowMs) / 1000));
    });

    const [isWarning, setIsWarning] = useState(false);
    const [isCritical, setIsCritical] = useState(false);

    useEffect(() => {
        if (remainingSeconds <= 0) {
            onTimeUp?.();
            return;
        }

        const interval = setInterval(() => {
            setRemainingSeconds((prev) => {
                const next = prev - 1;
                onTick?.(next);

                // Set warning states
                setIsWarning(next <= 300 && next > 60); // 5 min warning
                setIsCritical(next <= 60); // 1 min critical

                if (next <= 0) {
                    onTimeUp?.();
                    clearInterval(interval);
                }
                return Math.max(0, next);
            });
        }, 1000);

        return () => clearInterval(interval);
    }, [remainingSeconds, onTimeUp, onTick]);

    const formatTime = useCallback((totalSeconds: number) => {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        if (hours > 0) {
            return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }, []);

    const getTimerStyles = () => {
        if (isCritical) {
            return 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border-red-300 dark:border-red-700 animate-pulse';
        }
        if (isWarning) {
            return 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border-yellow-300 dark:border-yellow-700';
        }
        return 'bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800';
    };

    return (
        <div
            className={`inline-flex items-center gap-2 px-4 py-2 rounded-lg border-2 font-mono ${getTimerStyles()} ${className}`}
        >
            <svg
                className="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                />
            </svg>
            <span className="text-lg font-bold tabular-nums">
                {formatTime(remainingSeconds)}
            </span>
            {isCritical && (
                <span className="text-xs font-medium uppercase tracking-wide">
                    Hurry!
                </span>
            )}
        </div>
    );
}

export default ExamTimer;


%%%% FILE: D:\projects\oerms\oerms-frontend\components\exam\QuestionCard.tsx %%%%
'use client';

import { useState } from 'react';
import { motion, AnimatePresence, useReducedMotion } from 'framer-motion';
import { cn } from '@/lib/utils';
import { Flag, CheckCircle, X, Clock, BookOpen } from 'lucide-react';

export type QuestionType =
    | 'MCQ'
    | 'MULTIPLE_ANSWER'
    | 'TRUE_FALSE'
    | 'SHORT_ANSWER'
    | 'ESSAY'
    | 'FILL_BLANK'
    | 'MATCHING';

export interface QuestionOption {
    id: string;
    text: string;
}

export interface Question {
    id: string;
    questionText: string;
    type: QuestionType;
    marks: number;
    options?: QuestionOption[];
    imageUrl?: string;
}

export interface QuestionCardProps {
    question: Question;
    questionNumber: number;
    totalQuestions: number;
    selectedOptions?: string[];
    answerText?: string;
    isFlagged?: boolean;
    onOptionSelect?: (optionIds: string[]) => void;
    onAnswerTextChange?: (text: string) => void;
    onFlagToggle?: () => void;
    className?: string;
}

export function QuestionCard({
    question,
    questionNumber,
    totalQuestions,
    selectedOptions = [],
    answerText,
    isFlagged = false,
    onOptionSelect,
    onAnswerTextChange,
    onFlagToggle,
    className = '',
}: QuestionCardProps) {
    const shouldReduceMotion = useReducedMotion() || false;
    const [hasAnswered, setHasAnswered] = useState(selectedOptions.length > 0 || (answerText && answerText.trim().length > 0));

    const handleSingleSelect = (optionId: string) => {
        onOptionSelect?.([optionId]);
        setHasAnswered(true);
    };

    const handleMultiSelect = (optionId: string) => {
        const newSelection = selectedOptions.includes(optionId)
            ? selectedOptions.filter((id) => id !== optionId)
            : [...selectedOptions, optionId];
        onOptionSelect?.(newSelection);
        setHasAnswered(newSelection.length > 0);
    };

    const renderOptions = () => {
        if (!question.options) return null;

        const isMultiple = question.type === 'MULTIPLE_ANSWER';
        const isTrueFalse = question.type === 'TRUE_FALSE';

        return (
            <motion.div
                className="space-y-3"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.1 }}
            >
                {question.options.map((option, index) => {
                    const isSelected = selectedOptions.includes(option.id);
                    const letter = String.fromCharCode(65 + index);

                    return (
                        <motion.button
                            key={option.id}
                            type="button"
                            onClick={() =>
                                isMultiple
                                    ? handleMultiSelect(option.id)
                                    : handleSingleSelect(option.id)
                            }
                            className={cn(
                                "group w-full flex items-center gap-4 p-4 rounded-xl border-2 text-left",
                                "transition-all duration-200 ease-out",
                                "focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-500/20 focus-visible:ring-offset-2",
                                "hover:shadow-md active:scale-[0.99] select-none",
                                isSelected
                                    ? 'border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 shadow-sm'
                                    : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:bg-gray-50/80 dark:hover:bg-gray-800/50'
                            )}
                            whileHover={!shouldReduceMotion ? { scale: 1.01 } : undefined}
                            whileTap={!shouldReduceMotion ? { scale: 0.99 } : undefined}
                            initial={{ opacity: 0, x: -20 }}
                            animate={{ opacity: 1, x: 0 }}
                            transition={{
                                duration: shouldReduceMotion ? 0.01 : 0.2,
                                delay: index * 0.05
                            }}
                        >
                            <motion.span
                                className={cn(
                                    "flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold",
                                    "transition-all duration-200",
                                    isSelected
                                        ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg'
                                        : 'bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 text-gray-700 dark:text-gray-300 group-hover:from-blue-100 group-hover:to-indigo-100 dark:group-hover:from-blue-900/30 dark:group-hover:to-indigo-900/30'
                                )}
                                animate={isSelected ? {
                                    rotate: shouldReduceMotion ? 0 : [0, -10, 10, 0],
                                    scale: shouldReduceMotion ? 1 : [1, 1.1, 1]
                                } : undefined}
                                transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
                            >
                                {isTrueFalse ? (index === 0 ? 'T' : 'F') : letter}
                            </motion.span>

                            <span className="flex-1 text-gray-900 dark:text-gray-100 font-medium leading-relaxed">
                                {option.text}
                            </span>

                            <AnimatePresence>
                                {isMultiple && (
                                    <motion.span
                                        className="ml-auto"
                                        initial={{ scale: 0, opacity: 0 }}
                                        animate={{ scale: 1, opacity: 1 }}
                                        exit={{ scale: 0, opacity: 0 }}
                                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.2 }}
                                    >
                                        {isSelected ? (
                                            <CheckCircle className="w-6 h-6 text-blue-500" />
                                        ) : (
                                            <div className="w-6 h-6 rounded-full border-2 border-gray-300 dark:border-gray-600" />
                                        )}
                                    </motion.span>
                                )}
                            </AnimatePresence>
                        </motion.button>
                    );
                })}
            </motion.div>
        );
    };

    const renderTextAnswer = () => {
        const isEssay = question.type === 'ESSAY';

        return (
            <motion.div
                className="space-y-4"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.1 }}
            >
                {isEssay ? (
                    <motion.textarea
                        value={answerText || ''}
                        onChange={(e) => {
                            onAnswerTextChange?.(e.target.value);
                            setHasAnswered(e.target.value.trim().length > 0);
                        }}
                        placeholder="Type your detailed answer here..."
                        rows={10}
                        className={cn(
                            "w-full p-5 border-2 rounded-xl bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",
                            "placeholder-gray-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10",
                            "transition-all duration-200 resize-y",
                            "focus:outline-none focus:shadow-lg",
                            hasAnswered && "border-green-500 bg-green-50/50 dark:bg-green-900/10"
                        )}
                        initial={{ opacity: 0, scale: 0.95 }}
                        animate={{ opacity: 1, scale: 1 }}
                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
                    />
                ) : (
                    <motion.input
                        type="text"
                        value={answerText || ''}
                        onChange={(e) => {
                            onAnswerTextChange?.(e.target.value);
                            setHasAnswered(e.target.value.trim().length > 0);
                        }}
                        placeholder="Type your answer..."
                        className={cn(
                            "w-full p-4 border-2 rounded-xl bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",
                            "placeholder-gray-400 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10",
                            "transition-all duration-200",
                            "focus:outline-none focus:shadow-lg",
                            hasAnswered && "border-green-500 bg-green-50/50 dark:bg-green-900/10"
                        )}
                        initial={{ opacity: 0, scale: 0.95 }}
                        animate={{ opacity: 1, scale: 1 }}
                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
                    />
                )}

                {hasAnswered && (
                    <motion.div
                        className="flex items-center gap-2 text-green-600 dark:text-green-400"
                        initial={{ opacity: 0, y: 10 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.2 }}
                    >
                        <CheckCircle className="w-5 h-5" />
                        <span className="text-sm font-medium">Answer recorded</span>
                    </motion.div>
                )}
            </motion.div>
        );
    };

    const getQuestionTypeLabel = () => {
        const labels: Record<QuestionType, string> = {
            MCQ: 'Multiple Choice',
            MULTIPLE_ANSWER: 'Select All That Apply',
            TRUE_FALSE: 'True or False',
            SHORT_ANSWER: 'Short Answer',
            ESSAY: 'Essay',
            FILL_BLANK: 'Fill in the Blank',
            MATCHING: 'Matching',
        };
        return labels[question.type];
    };

    const getQuestionTypeIcon = () => {
        const icons: Record<QuestionType, React.ReactNode> = {
            MCQ: <BookOpen className="w-4 h-4" />,
            MULTIPLE_ANSWER: <CheckCircle className="w-4 h-4" />,
            TRUE_FALSE: <div className="w-4 h-4 rounded-full bg-gradient-to-r from-green-400 to-blue-400" />,
            SHORT_ANSWER: <div className="w-4 h-4 border-b-2 border-gray-400" />,
            ESSAY: <div className="w-4 h-4 border border-gray-400 rounded p-1 text-xs">A</div>,
            FILL_BLANK: <div className="w-4 h-4 border-b-2 border-dashed border-gray-400" />,
            MATCHING: <div className="w-4 h-4 flex items-center justify-center text-xs font-bold">↔</div>,
        };
        return icons[question.type];
    };

    return (
        <motion.div
            className={cn(
                "bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700",
                "overflow-hidden",
                isFlagged && "ring-2 ring-orange-500/50 shadow-orange-500/20",
                className
            )}
            initial={{ opacity: 0, y: 20, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            transition={{ duration: shouldReduceMotion ? 0.01 : 0.4, ease: "easeOut" }}
        >
            {/* Header */}
            <div className="flex items-center justify-between px-6 py-5 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-700">
                <div className="flex items-center gap-4">
                    <motion.div
                        className="flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-bold text-lg shadow-lg"
                        whileHover={!shouldReduceMotion ? { scale: 1.05, rotate: 5 } : undefined}
                        transition={{ type: "spring", stiffness: 400, damping: 17 }}
                    >
                        {questionNumber}
                    </motion.div>

                    <div className="flex flex-col">
                        <span className="text-sm text-gray-600 dark:text-gray-300 font-medium">
                            Question {questionNumber} of {totalQuestions}
                        </span>
                        <div className="flex items-center gap-2 mt-1">
                            {getQuestionTypeIcon()}
                            <span className="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800">
                                {getQuestionTypeLabel()}
                            </span>
                        </div>
                    </div>
                </div>

                <div className="flex items-center gap-4">
                    <motion.div
                        className="flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-bold shadow-lg"
                        whileHover={!shouldReduceMotion ? { scale: 1.05 } : undefined}
                        transition={{ type: "spring", stiffness: 400, damping: 17 }}
                    >
                        <span>{question.marks}</span>
                        <span className="text-sm font-medium">
                            {question.marks === 1 ? 'mark' : 'marks'}
                        </span>
                    </motion.div>

                    <motion.button
                        type="button"
                        onClick={onFlagToggle}
                        className={cn(
                            "p-3 rounded-xl transition-all duration-200",
                            "focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-orange-500/20",
                            isFlagged
                                ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg'
                                : 'bg-gray-100 dark:bg-gray-700 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'
                        )}
                        title={isFlagged ? 'Unflag question' : 'Flag for review'}
                        whileHover={!shouldReduceMotion ? { scale: 1.05 } : undefined}
                        whileTap={!shouldReduceMotion ? { scale: 0.95 } : undefined}
                        animate={isFlagged ? {
                            rotate: shouldReduceMotion ? 0 : [0, -5, 5, 0],
                        } : undefined}
                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
                    >
                        <Flag className="w-5 h-5" fill={isFlagged ? 'currentColor' : 'none'} />
                    </motion.button>
                </div>
            </div>

            {/* Question Content */}
            <div className="p-6">
                {/* Question Text */}
                <motion.div
                    className="mb-8"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ duration: shouldReduceMotion ? 0.01 : 0.5, delay: 0.2 }}
                >
                    <motion.h3
                        className="text-xl font-bold text-gray-900 dark:text-white leading-relaxed mb-4"
                        initial={{ opacity: 0, y: 10 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.3 }}
                    >
                        {question.questionText}
                    </motion.h3>

                    <AnimatePresence>
                        {question.imageUrl && (
                            <motion.div
                                className="mt-6"
                                initial={{ opacity: 0, scale: 0.9 }}
                                animate={{ opacity: 1, scale: 1 }}
                                exit={{ opacity: 0, scale: 0.9 }}
                                transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
                            >
                                <img
                                    src={question.imageUrl}
                                    alt="Question illustration"
                                    className="max-w-full h-auto rounded-xl border border-gray-200 dark:border-gray-700 shadow-lg"
                                />
                            </motion.div>
                        )}
                    </AnimatePresence>
                </motion.div>

                {/* Answer Input */}
                <div className="space-y-6">
                    {(question.type === 'MCQ' ||
                        question.type === 'MULTIPLE_ANSWER' ||
                        question.type === 'TRUE_FALSE') &&
                        renderOptions()}

                    {(question.type === 'SHORT_ANSWER' ||
                        question.type === 'ESSAY' ||
                        question.type === 'FILL_BLANK') &&
                        renderTextAnswer()}
                </div>
            </div>
        </motion.div>
    );
}

export default QuestionCard;


%%%% FILE: D:\projects\oerms\oerms-frontend\components\exam\QuestionNavigation.tsx %%%%
'use client';

export interface QuestionStatus {
    id: string;
    isAnswered: boolean;
    isFlagged: boolean;
}

interface QuestionNavigationProps {
    questions: QuestionStatus[];
    currentQuestionIndex: number;
    onQuestionSelect: (index: number) => void;
    className?: string;
}

export function QuestionNavigation({
    questions,
    currentQuestionIndex,
    onQuestionSelect,
    className = '',
}: QuestionNavigationProps) {
    const getButtonStyles = (question: QuestionStatus, index: number) => {
        const isCurrent = index === currentQuestionIndex;

        if (isCurrent) {
            return 'ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-800 bg-blue-500 text-white';
        }
        if (question.isFlagged) {
            return 'bg-orange-100 dark:bg-orange-900/40 text-orange-700 dark:text-orange-400 border-orange-300 dark:border-orange-700';
        }
        if (question.isAnswered) {
            return 'bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700';
        }
        return 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:bg-gray-200 dark:hover:bg-gray-600';
    };

    const answeredCount = questions.filter((q) => q.isAnswered).length;
    const flaggedCount = questions.filter((q) => q.isFlagged).length;

    return (
        <div className={`bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 ${className}`}>
            <h3 className="text-sm font-semibold text-gray-900 dark:text-white mb-4">
                Question Navigator
            </h3>

            {/* Stats */}
            <div className="flex gap-4 mb-4 text-xs">
                <div className="flex items-center gap-1.5">
                    <span className="w-3 h-3 rounded-full bg-green-500"></span>
                    <span className="text-gray-700 dark:text-gray-300">
                        Answered: {answeredCount}/{questions.length}
                    </span>
                </div>
                {flaggedCount > 0 && (
                    <div className="flex items-center gap-1.5">
                        <span className="w-3 h-3 rounded-full bg-orange-500"></span>
                        <span className="text-gray-700 dark:text-gray-300">
                            Flagged: {flaggedCount}
                        </span>
                    </div>
                )}
            </div>

            {/* Question Grid */}
            <div className="grid grid-cols-5 gap-2">
                {questions.map((question, index) => (
                    <button
                        key={question.id}
                        type="button"
                        onClick={() => onQuestionSelect(index)}
                        className={`w-10 h-10 rounded-lg border text-sm font-medium transition-all ${getButtonStyles(question, index)}`}
                    >
                        {index + 1}
                        {question.isFlagged && (
                            <span className="absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"></span>
                        )}
                    </button>
                ))}
            </div>

            {/* Legend */}
            <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                <div className="grid grid-cols-2 gap-2 text-xs text-gray-700 dark:text-gray-300">
                    <div className="flex items-center gap-2">
                        <span className="w-4 h-4 rounded bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600"></span>
                        Not Answered
                    </div>
                    <div className="flex items-center gap-2">
                        <span className="w-4 h-4 rounded bg-green-100 dark:bg-green-900/40 border border-green-300 dark:border-green-700"></span>
                        Answered
                    </div>
                    <div className="flex items-center gap-2">
                        <span className="w-4 h-4 rounded bg-orange-100 dark:bg-orange-900/40 border border-orange-300 dark:border-orange-700"></span>
                        Flagged
                    </div>
                    <div className="flex items-center gap-2">
                        <span className="w-4 h-4 rounded bg-blue-500"></span>
                        Current
                    </div>
                </div>
            </div>
        </div>
    );
}

export default QuestionNavigation;


%%%% FILE: D:\projects\oerms\oerms-frontend\components\exam\QuestionResultList.tsx %%%%
"use client";

import React from 'react';
import { motion, AnimatePresence, useReducedMotion } from 'framer-motion';
import { cn } from '@/lib/utils';
import { CheckCircle, X, AlertTriangle, Clock, BookOpen, FileText, Target, HelpCircle } from 'lucide-react';
import { AttemptResultDetailDTO, QuestionType } from '@/lib/types';

interface QuestionResultListProps {
  details: AttemptResultDetailDTO[];
}

export function QuestionResultList({ details }: QuestionResultListProps) {
  const shouldReduceMotion = useReducedMotion() || false;

  if (!details || details.length === 0) {
    return (
      <motion.div
        className="text-center py-12"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
      >
        <HelpCircle className="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4" />
        <p className="text-gray-500 dark:text-gray-400 text-lg">No question details available.</p>
      </motion.div>
    );
  }

  return (
    <motion.div
      className="space-y-6"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: shouldReduceMotion ? 0.01 : 0.4 }}
    >
      {details.map((detail, index) => (
        <QuestionResultItem key={detail.questionId} detail={detail} index={index} />
      ))}
    </motion.div>
  );
}

function QuestionResultItem({ detail, index }: { detail: AttemptResultDetailDTO; index: number }) {
  const shouldReduceMotion = useReducedMotion() || false;
  const isCorrect = detail.isCorrect === true;
  const isPartial = detail.marksObtained && detail.marksObtained > 0 && detail.marksObtained < detail.marksAllocated;

  let statusConfig = {
    color: "border-red-200 bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20",
    badgeColor: "bg-red-100 text-red-800 border-red-200",
    statusText: "Incorrect",
    icon: <X className="w-5 h-5 text-red-500" />,
    glow: "shadow-red-500/20"
  };

  if (isCorrect) {
    statusConfig = {
      color: "border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20",
      badgeColor: "bg-green-100 text-green-800 border-green-200",
      statusText: "Correct",
      icon: <CheckCircle className="w-5 h-5 text-green-500" />,
      glow: "shadow-green-500/20"
    };
  } else if (isPartial) {
    statusConfig = {
      color: "border-yellow-200 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20",
      badgeColor: "bg-yellow-100 text-yellow-800 border-yellow-200",
      statusText: "Partial",
      icon: <AlertTriangle className="w-5 h-5 text-yellow-500" />,
      glow: "shadow-yellow-500/20"
    };
  }

  const getQuestionTypeIcon = () => {
    const icons: Record<QuestionType, React.ReactNode> = {
      MCQ: <BookOpen className="w-4 h-4" />,
      MULTIPLE_ANSWER: <Target className="w-4 h-4" />,
      TRUE_FALSE: <div className="w-4 h-4 rounded-full bg-gradient-to-r from-green-400 to-blue-400" />,
      SHORT_ANSWER: <div className="w-4 h-4 border-b-2 border-gray-400" />,
      ESSAY: <FileText className="w-4 h-4" />,
      FILL_BLANK: <div className="w-4 h-4 border-b-2 border-dashed border-gray-400" />,
      MATCHING: <div className="w-4 h-4 flex items-center justify-center text-xs font-bold">↔</div>,
    };
    return icons[detail.questionType] || <HelpCircle className="w-4 h-4" />;
  };

  return (
    <motion.div
      className={cn(
        "border-2 rounded-2xl p-6 overflow-hidden relative",
        statusConfig.color,
        `shadow-lg ${statusConfig.glow}`
      )}
      initial={{ opacity: 0, y: 20, scale: 0.95 }}
      animate={{ opacity: 1, y: 0, scale: 1 }}
      transition={{
        duration: shouldReduceMotion ? 0.01 : 0.4,
        delay: index * 0.1,
        ease: "easeOut"
      }}
      whileHover={!shouldReduceMotion ? { scale: 1.02 } : undefined}
    >
      {/* Status indicator */}
      <div className="absolute top-4 right-4 flex items-center gap-2">
        <motion.div
          className={cn(
            "flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-bold border-2",
            statusConfig.badgeColor
          )}
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          transition={{ delay: index * 0.1 + 0.2, type: "spring", stiffness: 400, damping: 17 }}
        >
          {statusConfig.icon}
          {statusConfig.statusText}
        </motion.div>
      </div>

      {/* Header */}
      <motion.div
        className="flex justify-between items-start mb-6 pr-32"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: index * 0.1 + 0.1 }}
      >
        <div className="flex items-center gap-4">
          <motion.div
            className="flex items-center justify-center w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-bold text-lg shadow-lg"
            whileHover={!shouldReduceMotion ? { scale: 1.05, rotate: 5 } : undefined}
            transition={{ type: "spring", stiffness: 400, damping: 17 }}
          >
            {index + 1}
          </motion.div>

          <div className="flex flex-col">
            <div className="flex items-center gap-2 mb-1">
              {getQuestionTypeIcon()}
              <span className="text-xs text-gray-500 font-semibold uppercase tracking-wide">
                {detail.questionType.replace('_', ' ')}
              </span>
            </div>

            <div className="flex items-center gap-4 text-sm">
              {detail.timeSpentSeconds !== undefined && (
                <div className="flex items-center gap-1 text-gray-600 dark:text-gray-400">
                  <Clock className="w-4 h-4" />
                  <span>{detail.timeSpentSeconds}s</span>
                </div>
              )}
            </div>
          </div>
        </div>

        <motion.div
          className="text-right"
          initial={{ opacity: 0, x: 20 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ delay: index * 0.1 + 0.3 }}
        >
          <motion.div
            className="flex items-center gap-2 mb-1"
            initial={{ scale: 0 }}
            animate={{ scale: 1 }}
            transition={{ delay: index * 0.1 + 0.4, type: "spring", stiffness: 400, damping: 17 }}
          >
            <span className="text-2xl font-bold text-gray-900 dark:text-white">
              {detail.marksObtained ?? 0}
            </span>
            <span className="text-sm text-gray-500 dark:text-gray-400">
              / {detail.marksAllocated}
            </span>
          </motion.div>
          <div className="text-xs text-gray-500 dark:text-gray-400 font-medium">Marks</div>
        </motion.div>
      </motion.div>

      {/* Question Text */}
      <motion.div
        className="mb-6"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ delay: index * 0.1 + 0.2 }}
      >
        <h4 className="text-gray-900 dark:text-white font-bold text-xl leading-relaxed">
          {detail.questionText}
        </h4>
      </motion.div>

      {/* Answer Section */}
      <motion.div
        className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 shadow-inner"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: index * 0.1 + 0.3 }}
      >
        <AnswerSection detail={detail} />
      </motion.div>

      {/* Correct Answer (if wrong) */}
      <AnimatePresence>
        {!isCorrect && detail.correctAnswer && (
          <motion.div
            className="mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800 rounded-xl"
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: "auto" }}
            exit={{ opacity: 0, height: 0 }}
            transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
          >
            <div className="flex items-start gap-3">
              <CheckCircle className="w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 flex-shrink-0" />
              <div>
                <div className="text-sm font-bold text-green-700 dark:text-green-400 mb-1">
                  Correct Answer
                </div>
                <div className="text-sm text-green-800 dark:text-green-300 font-medium">
                  {detail.correctAnswer}
                </div>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </motion.div>
  );
}

function AnswerSection({ detail }: { detail: AttemptResultDetailDTO }) {
  const shouldReduceMotion = useReducedMotion() || false;
  const { questionType, options, studentSelectedOptions, studentAnswerText, correctAnswer } = detail;

  // Helper to check if an option was selected by the student
  const isSelected = (option: string) => studentSelectedOptions?.includes(option);

  // Helper to check if an option is the correct answer (simple check for MCQ)
  // Note: For complex types, this logic might need to be more robust based on backend data format
  const isOptionCorrect = (option: string) => correctAnswer === option;

  if (questionType === 'MCQ' || questionType === 'TRUE_FALSE' || questionType === 'MULTIPLE_ANSWER') {
    return (
      <motion.div
        className="space-y-3"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
      >
        {options?.map((option, idx) => {
          const selected = isSelected(option);
          const correct = isOptionCorrect(option);

          let optionConfig = {
            className: "border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50",
            icon: null as React.ReactNode,
            bgClass: "",
            ringClass: ""
          };

          if (selected && correct) {
            optionConfig = {
              className: "border-green-500 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 text-green-900 dark:text-green-100",
              icon: <CheckCircle className="w-5 h-5 text-green-600" />,
              bgClass: "shadow-green-500/20",
              ringClass: "ring-2 ring-green-500/50"
            };
          } else if (selected && !correct) {
            optionConfig = {
              className: "border-red-500 bg-gradient-to-r from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 text-red-900 dark:text-red-100",
              icon: <X className="w-5 h-5 text-red-600" />,
              bgClass: "shadow-red-500/20",
              ringClass: "ring-2 ring-red-500/50"
            };
          } else if (!selected && correct) {
            // Highlight missed correct answer
            optionConfig = {
              className: "border-green-500 bg-gradient-to-r from-green-50/70 to-emerald-50/70 dark:from-green-900/30 dark:to-emerald-900/30 text-green-900 dark:text-green-100 border-dashed",
              icon: <motion.div
                className="text-xs font-bold text-green-600"
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ delay: 0.5 }}
              >
                (Correct)
              </motion.div>,
              bgClass: "",
              ringClass: ""
            };
          }

          return (
            <motion.div
              key={idx}
              className={cn(
                "flex items-center gap-4 p-4 rounded-xl border-2 text-left transition-all duration-200",
                "focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-blue-500/20",
                optionConfig.className,
                optionConfig.bgClass,
                optionConfig.ringClass
              )}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: idx * 0.1 }}
              whileHover={!shouldReduceMotion ? { scale: 1.02 } : undefined}
            >
              <motion.span
                className="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center text-sm font-bold text-gray-700 dark:text-gray-300"
                whileHover={!shouldReduceMotion ? { scale: 1.1 } : undefined}
              >
                {String.fromCharCode(65 + idx)}
              </motion.span>

              <span className="flex-1 text-gray-900 dark:text-gray-100 font-medium leading-relaxed">
                {option}
              </span>

              <AnimatePresence>
                {optionConfig.icon && (
                  <motion.div
                    className="ml-auto"
                    initial={{ scale: 0, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    exit={{ scale: 0, opacity: 0 }}
                    transition={{ type: "spring", stiffness: 400, damping: 17 }}
                  >
                    {optionConfig.icon}
                  </motion.div>
                )}
              </AnimatePresence>
            </motion.div>
          );
        })}
      </motion.div>
    );
  }

  if (questionType === 'SHORT_ANSWER' || questionType === 'FILL_BLANK') {
    return (
      <motion.div
        className="space-y-4"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
      >
        <div>
          <motion.span
            className="text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.1 }}
          >
            Your Answer
          </motion.span>
          <motion.div
            className={cn(
              "mt-2 p-4 rounded-xl border-2 text-sm font-medium",
              detail.isCorrect
                ? "bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-500 text-green-900 dark:text-green-100 shadow-green-500/20"
                : "bg-gradient-to-r from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 border-red-500 text-red-900 dark:text-red-100 shadow-red-500/20"
            )}
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.2 }}
          >
            {studentAnswerText ? (
              <span className="break-words">{studentAnswerText}</span>
            ) : (
              <span className="italic text-gray-500 dark:text-gray-400">No answer provided</span>
            )}
          </motion.div>
        </div>
      </motion.div>
    );
  }

  if (questionType === 'ESSAY') {
    return (
      <motion.div
        className="space-y-4"
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
      >
        <div>
          <motion.span
            className="text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.1 }}
          >
            Your Answer
          </motion.span>
          <motion.div
            className="mt-2 p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap leading-relaxed max-h-60 overflow-y-auto"
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.2 }}
          >
            {studentAnswerText ? (
              <span className="break-words">{studentAnswerText}</span>
            ) : (
              <span className="italic text-gray-500 dark:text-gray-400">No answer provided</span>
            )}
          </motion.div>
        </div>

        {/* Essays usually don't have a single "correct answer" string to display simply,
            but if provided, we show it as model answer */}
        {correctAnswer && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
          >
            <span className="text-xs font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide">
              Model Answer / Key Points
            </span>
            <motion.div
              className="mt-2 p-4 rounded-xl border-2 border-blue-200 dark:border-blue-800 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 text-sm text-blue-900 dark:text-blue-100 font-medium"
              initial={{ opacity: 0, scale: 0.95 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ duration: shouldReduceMotion ? 0.01 : 0.3, delay: 0.4 }}
            >
              {correctAnswer}
            </motion.div>
          </motion.div>
        )}
      </motion.div>
    );
  }

  return (
    <motion.div
      className="text-center py-6"
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: shouldReduceMotion ? 0.01 : 0.3 }}
    >
      <HelpCircle className="w-12 h-12 text-gray-400 dark:text-gray-600 mx-auto mb-2" />
      <div className="text-gray-500 dark:text-gray-400 italic text-sm">
        Unsupported question type: {questionType}
      </div>
    </motion.div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\exams\ExamForm.tsx %%%%
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form'; // Assuming react-hook-form is available or I should just use controlled inputs if not
import { CreateExamRequest, ExamDTO } from '@/lib/types';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';
import { apiClient } from '@/lib/api';
import { useRouter } from 'next/navigation';
import { Loader2, Save } from 'lucide-react';

interface ExamFormProps {
    initialData?: ExamDTO;
    isEditing?: boolean;
}

export function ExamForm({ initialData, isEditing = false }: ExamFormProps) {
    const router = useRouter();
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');

    // Local state for simplicity, or could use react-hook-form
    const [formData, setFormData] = useState<Partial<CreateExamRequest>>({
        title: initialData?.title || '',
        description: initialData?.description || '',
        duration: initialData?.duration || 60,
        totalMarks: initialData?.totalMarks || 100,
        passingMarks: initialData?.passingMarks || 40,
        allowMultipleAttempts: initialData?.allowMultipleAttempts ?? false,
        shuffleQuestions: initialData?.shuffleQuestions ?? true,
        showResultsImmediately: initialData?.showResultsImmediately ?? true,
        instructions: initialData?.instructions || '',
        // Dates need formatted strings for inputs typically
        startTime: initialData?.startTime ? new Date(initialData.startTime).toISOString().slice(0, 16) : '',
        endTime: initialData?.endTime ? new Date(initialData.endTime).toISOString().slice(0, 16) : '',
    });

    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
        const { name, value, type } = e.target;
        const val = type === 'number' ? Number(value) : value;

        setFormData(prev => ({
            ...prev,
            [name]: val
        }));
    };

    const handleCheckboxChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        const { name, checked } = e.target;
        setFormData(prev => ({
            ...prev,
            [name]: checked
        }));
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
            if (isEditing && initialData) {
                // Implementation for update would go here
                await apiClient.updateExam(initialData.id, formData);
                router.push('/dashboard/exams');
            } else {
                await apiClient.createExam(formData as CreateExamRequest);
                router.push('/dashboard/exams');
            }
            router.refresh();
        } catch (err: any) {
            setError(err.message || 'Failed to save exam');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-6 max-w-4xl">
            <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 space-y-4">
                <h2 className="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                    {isEditing ? 'Edit Exam Details' : 'Basic Information'}
                </h2>

                {error && (
                    <div className="p-3 text-sm text-red-600 bg-red-50 dark:bg-red-900/20 rounded-lg">
                        {error}
                    </div>
                )}

                {/* Title */}
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Exam Title *</label>
                    <Input
                        name="title"
                        value={formData.title}
                        onChange={handleChange}
                        placeholder="e.g., Final Physics Exam 2024"
                        required
                    />
                </div>

                {/* Description */}
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                    <textarea
                        name="description"
                        value={formData.description}
                        onChange={handleChange}
                        className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows={3}
                        placeholder="Brief overview of the exam content..."
                    />
                </div>

                {/* Instructions */}
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Instructions for Students</label>
                    <textarea
                        name="instructions"
                        value={formData.instructions}
                        onChange={handleChange}
                        className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows={4}
                        placeholder="Rules, guidelines, and what to expect..."
                    />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* Duration */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Duration (minutes) *</label>
                        <Input
                            type="number"
                            name="duration"
                            value={formData.duration}
                            onChange={handleChange}
                            min={1}
                            required
                        />
                    </div>

                    {/* Total Marks */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Marks *</label>
                        <Input
                            type="number"
                            name="totalMarks"
                            value={formData.totalMarks}
                            onChange={handleChange}
                            min={1}
                            required
                        />
                    </div>

                    {/* Passing Marks */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Passing Marks *</label>
                        <Input
                            type="number"
                            name="passingMarks"
                            value={formData.passingMarks}
                            onChange={handleChange}
                            min={1}
                            required
                        />
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {/* Start Time */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Start Time (Optional)</label>
                        <Input
                            type="datetime-local"
                            name="startTime"
                            value={formData.startTime}
                            onChange={handleChange}
                        />
                        <p className="text-xs text-gray-500 mt-1">Leave empty if exam can be taken anytime.</p>
                    </div>

                    {/* End Time */}
                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">End Time (Optional)</label>
                        <Input
                            type="datetime-local"
                            name="endTime"
                            value={formData.endTime}
                            onChange={handleChange}
                        />
                    </div>
                </div>

                {/* Settings Toggles */}
                <div className="space-y-3 pt-2">
                    <label className="flex items-center gap-3 p-3 border border-gray-100 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <input
                            type="checkbox"
                            name="shuffleQuestions"
                            checked={formData.shuffleQuestions}
                            onChange={handleCheckboxChange}
                            className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                        />
                        <div>
                            <span className="block text-sm font-medium text-gray-900 dark:text-white">Shuffle Questions</span>
                            <span className="block text-xs text-gray-500">Randomize question order for each student</span>
                        </div>
                    </label>

                    <label className="flex items-center gap-3 p-3 border border-gray-100 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <input
                            type="checkbox"
                            name="showResultsImmediately"
                            checked={formData.showResultsImmediately}
                            onChange={handleCheckboxChange}
                            className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                        />
                        <div>
                            <span className="block text-sm font-medium text-gray-900 dark:text-white">Show Results Immediately</span>
                            <span className="block text-xs text-gray-500">Allow students to see score right after submission</span>
                        </div>
                    </label>

                    <label className="flex items-center gap-3 p-3 border border-gray-100 dark:border-gray-700 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <input
                            type="checkbox"
                            name="allowMultipleAttempts"
                            checked={formData.allowMultipleAttempts}
                            onChange={handleCheckboxChange}
                            className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                        />
                        <div>
                            <span className="block text-sm font-medium text-gray-900 dark:text-white">Allow Multiple Attempts</span>
                            <span className="block text-xs text-gray-500">Students can retake the exam</span>
                        </div>
                    </label>
                </div>
            </div>

            <div className="flex gap-4">
                <Button type="submit" variant="primary" size="lg" disabled={loading} className="w-full md:w-auto">
                    {loading ? (
                        <>
                            <Loader2 className="w-4 h-4 animate-spin mr-2" />
                            Saving...
                        </>
                    ) : (
                        <>
                            <Save className="w-4 h-4 mr-2" />
                            {isEditing ? 'Update Exam' : 'Create Exam'}
                        </>
                    )}
                </Button>
                <Button type="button" variant="outline" size="lg" onClick={() => router.back()} disabled={loading} className="w-full md:w-auto">
                    Cancel
                </Button>
            </div>
        </form>
    );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\dashboard-layout.tsx %%%%
// components/layout/dashboard-layout.tsx - Modern Dashboard Layout
'use client';

import React from 'react';
import { Sidebar } from './Sidebar';
import { TopBar } from './TopBar';
import { ToastProvider } from '@/components/ui/Toast';
import { ErrorBoundaryWrapper } from '@/components/common/error-boundary';
import { motion } from 'framer-motion';

interface DashboardLayoutProps {
  children: React.ReactNode;
}

export function DashboardLayout({ children }: DashboardLayoutProps) {
  return (
    <ToastProvider>
      <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/20 to-purple-50/20">
        <Sidebar />

        <div className="lg:pl-[280px]">
          <TopBar />

          <motion.main
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3 }}
            className="p-6 min-h-[calc(100vh-4rem)]"
          >
            <ErrorBoundaryWrapper>
              {children}
            </ErrorBoundaryWrapper>
          </motion.main>
        </div>
      </div>
    </ToastProvider>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\DashboardLayout.tsx %%%%
'use client';

import { Sidebar } from '@/components/layout/Sidebar';
import { TopBar } from '@/components/layout/TopBar';
import { ReactNode } from 'react';

export function DashboardLayout({ children }: { children: ReactNode }) {
    return (
        <div className="flex h-screen bg-gray-50 dark:bg-gray-900 overflow-hidden">
            {/* Fixed Sidebar */}
            <Sidebar className="flex-shrink-0" />

            {/* Main Content Area */}
            <div className="flex-1 flex flex-col min-w-0 overflow-hidden">
                <TopBar />

                {/* Scrollable Page Content */}
                <main className="flex-1 overflow-y-auto p-4 md:p-6 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        {children}
                    </div>
                </main>
            </div>
        </div>
    );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\Footer.tsx %%%%
"use client";

import Link from 'next/link';
import { useAuth } from '@/hooks/useAuth';

export function Footer() {
  const { isAuthenticated, user } = useAuth();

  return (
    <footer className="bg-gray-50 border-t border-gray-200 relative">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <h3 className="text-lg font-semibold text-gray-900 mb-4">OERMS</h3>
            <p className="text-gray-600 text-sm">
              A comprehensive platform for online examination management built with modern microservices architecture.
            </p>
          </div>

          <div>
            <h4 className="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Quick Links</h4>
            <ul className="space-y-2">
              <li><Link href="/" className="text-gray-600 hover:text-gray-900 text-sm">Home</Link></li>
              <li><Link href="/about" className="text-gray-600 hover:text-gray-900 text-sm">About</Link></li>
              <li><Link href="/api/auth/start" className="text-gray-600 hover:text-gray-900 text-sm">Login</Link></li>
            </ul>
          </div>

          <div>
            <h4 className="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Tech Stack</h4>
            <div className="flex flex-wrap gap-2">
              <span className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">Spring Boot</span>
              <span className="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Next.js</span>
              <span className="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded">Kafka</span>
              <span className="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded">PostgreSQL</span>
            </div>
          </div>

          <div>
            <h4 className="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Account</h4>
            <ul className="space-y-2">
              {isAuthenticated ? (
                <>
                  <li><Link href="/dashboard" className="text-gray-600 hover:text-gray-900 text-sm">Dashboard</Link></li>
                  <li><Link href="/profile" className="text-gray-600 hover:text-gray-900 text-sm">Profile</Link></li>
                  <li><Link href="/logout" className="text-gray-600 hover:text-gray-900 text-sm">Logout</Link></li>
                </>
              ) : (
                <>
                  <li><Link href="/dashboard" className="text-gray-600 hover:text-gray-900 text-sm">Dashboard</Link></li>
                  <li><Link href="/profile" className="text-gray-600 hover:text-gray-900 text-sm">Profile</Link></li>
                  <li><Link href="/api/auth/start" className="text-gray-600 hover:text-gray-900 text-sm">Login</Link></li>
                </>
              )}
            </ul>
          </div>
        </div>

        <div className="mt-8 pt-8 border-t border-gray-200">
          <p className="text-center text-gray-500 text-sm">
            © {new Date().getFullYear()} OERMS. All rights reserved.
          </p>
        </div>
      </div>
    </footer>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\Hero.tsx %%%%
import Link from 'next/link';
import { Button } from '../ui/Button';

export function Hero() {
  return (
    <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
        <div className="text-center">
          <h1 className="text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight">
            Online Exam & Result
            <span className="block text-blue-200">Management System</span>
          </h1>

          <p className="mt-6 max-w-2xl mx-auto text-xl text-blue-100">
            A modern, secure, and scalable platform for conducting online examinations
            and managing results with role-based access control.
          </p>

          <div className="mt-10 flex flex-col sm:flex-row gap-4 justify-center">
            <a href={`${process.env.NEXT_PUBLIC_OERMS_ISSUER}/register`}>
              <Button size="lg" className="w-full sm:w-auto bg-white text-blue-600 hover:bg-blue-50">
                Get Started
              </Button>
            </a>

            <Link href="/api/auth/start">
              <Button size="lg" variant="outline" className="w-full sm:w-auto border-white text-white hover:bg-blue-700">
                Login
              </Button>
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\Navbar.tsx %%%%
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { useState } from 'react';
import { useAuth } from '@/hooks/useAuth';
import { Button } from '../ui/Button';
import { User } from 'lucide-react';

export function Navbar() {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const { user, isAuthenticated, logout } = useAuth();
  const pathname = usePathname();

  const isActive = (path: string) => pathname === path;

  // Hide Navbar on dashboard and admin routes to prevent double topbars
  if (pathname?.startsWith('/dashboard') || pathname?.startsWith('/admin')) {
    return null;
  }

  const navLinks = [
    { href: '/', label: 'Home' },
    { href: '/features', label: 'Features' },
    { href: '/pricing', label: 'Pricing' },
    { href: '/about', label: 'About' },
    { href: '/contact', label: 'Contact' },
  ];

  const authNavLinks = [
    { href: '/dashboard', label: 'Dashboard' },
    // Show admin link if user has ADMIN role
    ...(user?.roles?.includes('ADMIN') || user?.roles?.includes('ROLE_ADMIN') ? [{ href: '/admin', label: 'Admin' }] : []),
  ];

  const handleLogout = async () => {
    await logout();
    window.location.href = '/login';
  };

  return (
    <nav className="bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800 sticky top-0 z-50 backdrop-blur-lg bg-white/90 dark:bg-gray-900/90">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between h-16">
          {/* Logo */}
          <div className="flex items-center">
            <Link href="/" className="flex items-center gap-2">
              <div className="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                <span className="text-white font-bold text-sm">O</span>
              </div>
              <span className="text-xl font-bold text-gray-900 dark:text-white">OERMS</span>
            </Link>

            {/* Desktop Navigation */}
            <div className="hidden lg:ml-10 lg:flex lg:space-x-1">
              {navLinks.map((link) => (
                <Link
                  key={link.href}
                  href={link.href}
                  className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${isActive(link.href)
                      ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20'
                      : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-800'
                    }`}
                >
                  {link.label}
                </Link>
              ))}

              {isAuthenticated && authNavLinks.map((link) => (
                <Link
                  key={link.href}
                  href={link.href}
                  className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${isActive(link.href)
                      ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20'
                      : 'text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-800'
                    }`}
                >
                  {link.label}
                </Link>
              ))}
            </div>
          </div>

          {/* Desktop Auth Buttons */}
          <div className="hidden lg:flex lg:items-center lg:gap-3">
            {isAuthenticated ? (
              <>
                <Link
                  href="/profile"
                  className="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
                >
                  <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                    <User className="w-4 h-4 text-white" />
                  </div>
                  <span>{user?.username}</span>
                </Link>
                <Button variant="outline" size="sm" onClick={handleLogout}>
                  Logout
                </Button>
              </>
            ) : (
              <>
                <Link href="/login">
                  <Button variant="ghost" size="sm">
                    Sign In
                  </Button>
                </Link>
                <Link href="/register">
                  <Button variant="primary" size="sm">
                    Get Started
                  </Button>
                </Link>
              </>
            )}
          </div>

          {/* Mobile Menu Button */}
          <div className="flex items-center lg:hidden">
            <button
              onClick={() => setIsMenuOpen(!isMenuOpen)}
              className="inline-flex items-center justify-center p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors touch-target touch-target-ensure"
              aria-expanded={isMenuOpen}
              aria-label="Toggle navigation menu"
            >
              <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {isMenuOpen ? (
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                ) : (
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                )}
              </svg>
            </button>
          </div>
        </div>
      </div>

      {/* Mobile Menu */}
      {isMenuOpen && (
        <div className="lg:hidden border-t border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 safe-area-bottom">
          <div className="py-3 px-4 space-y-1">
            {navLinks.map((link) => (
              <Link
                key={link.href}
                href={link.href}
                onClick={() => setIsMenuOpen(false)}
                className={`block px-4 py-3 rounded-lg text-base font-medium transition-colors touch-target ${isActive(link.href)
                    ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20'
                    : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'
                  }`}
              >
                {link.label}
              </Link>
            ))}

            {isAuthenticated && (
              <>
                <div className="border-t border-gray-100 dark:border-gray-800 my-2"></div>
                {authNavLinks.map((link) => (
                  <Link
                    key={link.href}
                    href={link.href}
                    onClick={() => setIsMenuOpen(false)}
                    className={`block px-4 py-3 rounded-lg text-base font-medium transition-colors touch-target ${isActive(link.href)
                        ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20'
                        : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'
                      }`}
                  >
                    {link.label}
                  </Link>
                ))}
                <Link
                  href="/profile"
                  onClick={() => setIsMenuOpen(false)}
                  className="block px-4 py-3 rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors touch-target"
                >
                  Profile
                </Link>
              </>
            )}
          </div>

          {/* Mobile Auth Section */}
          <div className="py-4 px-4 border-t border-gray-100 dark:border-gray-800">
            {isAuthenticated ? (
              <div className="space-y-3">
                <div className="flex items-center gap-3 px-4 py-2">
                  <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                    <User className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">{user?.username}</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">Signed in</p>
                  </div>
                </div>
                <Button variant="outline" size="sm" onClick={handleLogout} className="w-full">
                  Logout
                </Button>
              </div>
            ) : (
              <div className="space-y-2">
                <Link href="/login" className="block" onClick={() => setIsMenuOpen(false)}>
                  <Button variant="outline" size="sm" className="w-full">
                    Sign In
                  </Button>
                </Link>
                <Link href="/register" className="block" onClick={() => setIsMenuOpen(false)}>
                  <Button variant="primary" size="sm" className="w-full">
                    Get Started Free
                  </Button>
                </Link>
              </div>
            )}
          </div>
        </div>
      )}
    </nav>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\Sidebar.tsx %%%%
'use client';

import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { usePathname } from 'next/navigation';
import { useAuth } from '@/hooks/useAuth';
import {
    LayoutDashboard,
    BookOpen,
    FileQuestion,
    Users,
    Settings,
    GraduationCap,
    ClipboardList,
    BarChart,
    LogOut,
    Menu,
    Clock,
    CheckCircle2,
    TrendingUp
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { useState } from 'react';
import { Button } from '@/components/ui/Button';

interface SidebarProps {
    className?: string;
}

export function Sidebar({ className }: SidebarProps) {
    const pathname = usePathname();
    const router = useRouter();
    const { user, hasRole } = useAuth();
    const [collapsed, setCollapsed] = useState(false);

    // Common links
    const links = [
        {
            label: 'Dashboard',
            href: '/dashboard',
            icon: LayoutDashboard
        },
    ];

    // Admin Links
    if (hasRole('ADMIN')) {
        links.push(
            { label: 'Users', href: '/admin/users', icon: Users },
            { label: 'Exams', href: '/admin/exams', icon: BookOpen },
            { label: 'All Results', href: '/results', icon: GraduationCap },
            { label: 'All Attempts', href: '/dashboard/attempts', icon: ClipboardList },
            { label: 'System Health', href: '/dashboard/admin', icon: BarChart }
        );
    }

    // Teacher Links
    if (hasRole('TEACHER')) {
        links.push(
            { label: 'My Exams', href: '/dashboard/exams', icon: BookOpen },
            { label: 'Question Bank', href: '/questions', icon: FileQuestion },
            { label: 'Student Attempts', href: '/dashboard/attempts', icon: ClipboardList },
            { label: 'All Results', href: '/results', icon: GraduationCap },
            { label: 'Pending Grading', href: '/dashboard/grading', icon: CheckCircle2 },
            { label: 'Analytics', href: '/dashboard/analytics', icon: TrendingUp }
        );
    }

    // Student Links
    if (hasRole('STUDENT')) {
        links.push(
            { label: 'Available Exams', href: '/exams/published', icon: BookOpen },
            { label: 'My Attempts', href: '/dashboard/attempts', icon: Clock },
            { label: 'My Results', href: '/results', icon: GraduationCap }
        );
    }

    // Profile/Settings always at bottom logic or here
    links.push({ label: 'Profile', href: '/profile', icon: Users });

    return (
        <div className={cn("flex flex-col h-screen bg-slate-900 text-white transition-all duration-300", collapsed ? "w-16" : "w-64", className)}>
            {/* Brand */}
            <div className="flex items-center justify-between p-4 border-b border-slate-700">
                {!collapsed && <span className="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">OERMS</span>}
                <Button variant="ghost" size="sm" onClick={() => setCollapsed(!collapsed)} className="p-1 hover:bg-slate-800 text-slate-300 dark:text-slate-300">
                    <Menu className="w-5 h-5" />
                </Button>
            </div>

            {/* Navigation */}
            <nav className="flex-1 p-2 space-y-1 overflow-y-auto">
                {links.map((link) => {
                    const Icon = link.icon;
                    const isActive = pathname.startsWith(link.href);

                    return (
                        <Link
                            key={link.href}
                            href={link.href}
                            className={cn(
                                "flex items-center gap-3 px-3 py-2 rounded-lg transition-colors group",
                                isActive
                                    ? "bg-blue-600 text-white"
                                    : "text-slate-300 hover:bg-slate-800 hover:text-white dark:text-slate-300"
                            )}
                            title={collapsed ? link.label : undefined}
                            onClick={(e) => {
                                e.preventDefault();
                                router.push(link.href);
                            }}
                        >
                            <Icon className="w-5 h-5 flex-shrink-0" />
                            {!collapsed && <span>{link.label}</span>}
                            {collapsed && isActive && (
                                <div className="absolute left-16 w-2 h-2 rounded-full bg-blue-500" />
                            )}
                        </Link>
                    );
                })}
            </nav>

            {/* User Footer */}
            <div className="p-4 border-t border-slate-700">
                <div className={cn("flex items-center gap-3", collapsed && "justify-center")}>
                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center text-xs font-bold">
                        {user?.username?.[0]?.toUpperCase() || 'U'}
                    </div>
                    {!collapsed && (
                        <div className="overflow-hidden">
                            <p className="text-sm font-medium truncate">{user?.username}</p>
                            <p className="text-xs text-slate-300 dark:text-slate-300 truncate">{user?.roles?.[0] || 'User'}</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\layout\TopBar.tsx %%%%
'use client';

import { Bell, Search } from 'lucide-react';
import { Input } from '@/components/ui/Input';
import { Button } from '@/components/ui/Button';
import { useAuth } from '@/hooks/useAuth';
import Link from 'next/link';

export function TopBar() {
    const { logout } = useAuth();

    const handleLogout = async () => {
        console.log('TopBar logout button clicked');
        try {
            await logout();
            console.log('TopBar logout completed');
        } catch (error) {
            console.error('TopBar logout failed:', error);
        }
    };

    return (
        <header className="h-16 bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between px-6 sticky top-0 z-40 shadow-sm">
            {/* Search */}
            <div className="w-96 hidden md:block">
                <div className="relative">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 dark:text-gray-300" />
                    <input
                        type="text"
                        placeholder="Search..."
                        className="w-full pl-10 pr-4 py-2 text-sm bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all"
                    />
                </div>
            </div>

            {/* Actions */}
            <div className="flex items-center gap-4">
                <Button variant="ghost" size="sm" className="relative text-gray-600 hover:text-gray-700 dark:text-gray-300 touch-target-ensure">
                    <Bell className="w-5 h-5" />
                    <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-gray-800"></span>
                </Button>

                <div className="h-8 w-px bg-gray-200 dark:bg-gray-700 mx-1"></div>

                <Button variant="outline" size="sm" onClick={handleLogout} className="text-red-500 hover:text-red-600 hover:bg-red-50 border-red-100">
                    Log out
                </Button>
            </div>
        </header>
    );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\profile\AvatarUploader.tsx %%%%
'use client';

import { useState, useRef, ChangeEvent, useEffect } from 'react';
import { Button } from '../ui/Button';
import Image from 'next/image';

interface AvatarUploaderProps {
  currentAvatar?: string;
  onUpload: (file: File) => Promise<void>;
  isLoading?: boolean;
  onFileSelect?: (file: File | null) => void;
}

export function AvatarUploader({ currentAvatar, onUpload, isLoading, onFileSelect }: AvatarUploaderProps) {
  const [preview, setPreview] = useState<string | null>(currentAvatar || null);
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [error, setError] = useState<string>('');
  const [success, setSuccess] = useState<string>('');
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Update preview when currentAvatar changes
  useEffect(() => {
    if (currentAvatar) {
      setPreview(currentAvatar);
    }
  }, [currentAvatar]);

  const handleFileSelect = (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    console.log('File selected:', file?.name, file?.type, file?.size);

    if (!file) {
      console.log('No file selected');
      return;
    }

    if (!file.type.startsWith('image/')) {
      setError('Please select an image file');
      console.log('Invalid file type:', file.type);
      return;
    }

    if (file.size > 5 * 1024 * 1024) {
      setError('File size must be less than 5MB');
      console.log('File too large:', file.size);
      return;
    }

    setError('');
    setSuccess('');
    setSelectedFile(file);
    onFileSelect?.(file);

    // Create preview
    const reader = new FileReader();
    reader.onloadend = () => {
      console.log('Preview created');
      setPreview(reader.result as string);
    };
    reader.readAsDataURL(file);
  };

  const handleUpload = async () => {
    if (!selectedFile) {
      console.log('No file to upload');
      return;
    }

    console.log('Starting upload for:', selectedFile.name);
    setError('');
    setSuccess('');

    try {
      await onUpload(selectedFile);
      console.log('Upload successful');
      setSelectedFile(null);
      onFileSelect?.(null);
      setSuccess('Photo uploaded successfully!');
      if (fileInputRef.current) {
        fileInputRef.current.value = '';
      }
    } catch (err: any) {
      console.error('Upload failed:', err);
      setError(err.message || 'Failed to upload image');
    }
  };

  const handleClick = () => {
    console.log('Choose photo clicked');
    fileInputRef.current?.click();
  };

  return (
    <div className="space-y-4">
      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Profile Picture</label>
      <div className="flex items-center gap-6">
        <div className="relative w-32 h-32 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-4 border-gray-100 dark:border-gray-600">
          {preview ? (
            <Image src={preview} alt="Profile preview" fill className="object-cover" sizes="128px" unoptimized />
          ) : (
            <svg className="w-16 h-16 text-gray-500 dark:text-gray-300" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
          )}
        </div>

        <div className="flex-1 space-y-3">
          <input
            ref={fileInputRef}
            type="file"
            accept="image/*"
            onChange={handleFileSelect}
            className="hidden"
            aria-label="Select profile picture"
          />

          <div className="flex flex-wrap gap-2">
            <Button type="button" variant="outline" onClick={handleClick} disabled={isLoading}>
              {preview ? 'Change Photo' : 'Choose Photo'}
            </Button>
            {selectedFile && (
              <Button type="button" onClick={handleUpload} disabled={isLoading}>
                {isLoading ? (
                  <>
                    <svg className="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Uploading...
                  </>
                ) : 'Upload Photo'}
              </Button>
            )}
          </div>

          {selectedFile && (
            <p className="text-sm text-blue-600 dark:text-blue-400">
              Selected: {selectedFile.name} ({(selectedFile.size / 1024).toFixed(1)} KB)
            </p>
          )}

          {error && (
            <p className="text-sm text-red-600 dark:text-red-400" role="alert">
              ⚠️ {error}
            </p>
          )}

          {success && (
            <p className="text-sm text-green-600 dark:text-green-400" role="status">
              ✓ {success}
            </p>
          )}

          <p className="text-xs text-gray-600 dark:text-gray-300">
            Supported formats: JPG, PNG, GIF. Max size: 5MB
          </p>
        </div>
      </div>
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\profile\ProfileForm.tsx %%%%
'use client';

import { useState, FormEvent } from 'react';
import { Input } from '../ui/Input';
import { Button } from '../ui/Button';
import { ProfileUpdateRequest } from '@/lib/types';

interface ProfileFormProps {
  initialData?: Partial<ProfileUpdateRequest>;
  onSubmit: (data: ProfileUpdateRequest) => Promise<void>;
  isLoading?: boolean;
}

export function ProfileForm({ initialData, onSubmit, isLoading }: ProfileFormProps) {
  const [formData, setFormData] = useState<ProfileUpdateRequest>({
    firstName: initialData?.firstName || '',
    lastName: initialData?.lastName || '',
    city: initialData?.city || '',
    institution: initialData?.institution || '',
    email: initialData?.email,
  });

  const [errors, setErrors] = useState<Record<string, string>>({});

  const validateForm = (): boolean => {
    const newErrors: Record<string, string> = {};

    if (!formData.firstName.trim()) newErrors.firstName = 'First name is required';
    if (!formData.lastName.trim()) newErrors.lastName = 'Last name is required';
    if (!formData.city.trim()) newErrors.city = 'City is required';
    if (!formData.institution.trim()) newErrors.institution = 'Institution is required';

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    if (!validateForm()) return;

    try {
      await onSubmit(formData);
    } catch (error) {
      console.error('Form submission error:', error);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Input
          label="First Name"
          name="firstName"
          value={formData.firstName}
          onChange={(e) => setFormData(prev => ({ ...prev, firstName: e.target.value }))}
          error={errors.firstName}
          required
          aria-required="true"
        />
        <Input
          label="Last Name"
          name="lastName"
          value={formData.lastName}
          onChange={(e) => setFormData(prev => ({ ...prev, lastName: e.target.value }))}
          error={errors.lastName}
          required
          aria-required="true"
        />
      </div>

      <Input
        label="City"
        name="city"
        value={formData.city}
        onChange={(e) => setFormData(prev => ({ ...prev, city: e.target.value }))}
        error={errors.city}
        required
        aria-required="true"
      />

      <Input
        label="Institution"
        name="institution"
        value={formData.institution}
        onChange={(e) => setFormData(prev => ({ ...prev, institution: e.target.value }))}
        error={errors.institution}
        helperText="Enter your school, college, or university name"
        required
        aria-required="true"
      />

      {initialData?.email && (
        <Input
          label="Email"
          name="email"
          type="email"
          value={formData.email || ''}
          onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
          helperText="Optional: Update your email address"
        />
      )}

      <div className="flex justify-end gap-4 pt-4 border-t border-gray-100">
        <Button
          type="button"
          variant="secondary"
          onClick={() => window.history.back()}
          disabled={isLoading}
          className="bg-gray-200 text-gray-800 hover:bg-gray-300"
        >
          Cancel
        </Button>
        <Button
          type="submit"
          disabled={isLoading}
          className="bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500"
        >
          {isLoading ? (
            <span className="flex items-center gap-2">
              <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
              Saving...
            </span>
          ) : (
            'Save Profile'
          )}
        </Button>
      </div>
    </form>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\providers\AlertBridge.tsx %%%%
"use client";

import { useEffect, useRef } from "react";
import { useToast } from "@/components/ui/Toast";

/**
 * AlertBridge intercepts window.alert calls and routes them to the Toast system.
 * This upgrades legacy alert-based UX across all pages without editing each page.
 */
export function AlertBridge() {
  const { addToast } = useToast();
  const originalAlertRef = useRef<typeof window.alert | null>(null);

  useEffect(() => {
    // Preserve original alert so we can restore on unmount
    if (!originalAlertRef.current) {
      originalAlertRef.current = window.alert.bind(window);
    }

    const patchedAlert = (message?: any) => {
      const text = typeof message === "string" ? message : String(message);
      addToast(text, "info");
    };

    window.alert = patchedAlert as any;

    return () => {
      if (originalAlertRef.current) {
        window.alert = originalAlertRef.current as any;
      }
    };
  }, [addToast]);

  return null;
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\questions\QuestionForm.tsx %%%%
'use client';

import { useState } from 'react';
import { CreateQuestionRequest, QuestionType, DifficultyLevel } from '@/lib/types';
import { Button } from '@/components/ui/Button';
import { Input } from '@/components/ui/Input';
import { apiClient } from '@/lib/api';
import { useRouter } from 'next/navigation';
import { Loader2, Save, Plus, X } from 'lucide-react';

interface QuestionFormProps {
    examId: string;
    initialData?: any; // Should be QuestionDTO but types might vary slightly
    isEditing?: boolean;
}

export function QuestionForm({ examId, initialData, isEditing = false }: QuestionFormProps) {
    const router = useRouter();
    const [loading, setLoading] = useState(false);

    const [formData, setFormData] = useState<Partial<CreateQuestionRequest>>({
        examId: examId,
        questionText: initialData?.questionText || '',
        type: initialData?.type || 'MCQ',
        marks: initialData?.marks || 1,
        difficultyLevel: initialData?.difficultyLevel || 'MEDIUM',
        correctAnswer: initialData?.correctAnswer || '',
        options: initialData?.options || ['', '', '', ''], // Default 4 options for MCQ
        explanation: initialData?.explanation || '',
    });

    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleOptionChange = (index: number, value: string) => {
        const newOptions = [...(formData.options || [])];
        newOptions[index] = value;
        setFormData(prev => ({ ...prev, options: newOptions }));
    };

    const addOption = () => {
        setFormData(prev => ({ ...prev, options: [...(prev.options || []), ''] }));
    };

    const removeOption = (index: number) => {
        const newOptions = [...(formData.options || [])];
        newOptions.splice(index, 1);
        setFormData(prev => ({ ...prev, options: newOptions }));
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);

        try {
            if (isEditing && initialData?.id) {
                await apiClient.updateQuestion(initialData.id, formData);
            } else {
                await apiClient.createQuestion(formData as CreateQuestionRequest); // Cast, assuming validation passes
            }
            router.push(`/dashboard/exams/${examId}/questions`);
            router.refresh();
        } catch (error: any) {
            alert(error.message || 'Failed to save question');
        } finally {
            setLoading(false);
        }
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-6 bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-100 dark:border-gray-700">

            {/* Type & Marks Row */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Question Type</label>
                    <select
                        name="type"
                        value={formData.type}
                        onChange={handleChange}
                        className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="MCQ">Multiple Choice</option>
                        <option value="TRUE_FALSE">True / False</option>
                        <option value="SHORT_ANSWER">Short Answer</option>
                    </select>
                </div>

                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Difficulty</label>
                    <select
                        name="difficultyLevel"
                        value={formData.difficultyLevel}
                        onChange={handleChange}
                        className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="EASY">Easy</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="HARD">Hard</option>
                    </select>
                </div>

                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Marks</label>
                    <Input
                        type="number"
                        name="marks"
                        value={formData.marks}
                        onChange={handleChange}
                        min={1}
                        required
                    />
                </div>
            </div>

            {/* Question Text */}
            <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Question Text</label>
                <textarea
                    name="questionText"
                    value={formData.questionText}
                    onChange={handleChange}
                    required
                    rows={3}
                    className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter the question..."
                />
            </div>

            {/* Options (MCQ Only) */}
            {formData.type === 'MCQ' && (
                <div className="space-y-3">
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Options</label>
                    {formData.options?.map((option, index) => (
                        <div key={index} className="flex gap-2">
                            <div className="flex-none pt-2">
                                <input
                                    type="radio"
                                    name="correctAnswerSelect"
                                    checked={formData.correctAnswer === option && option !== ''}
                                    onChange={() => setFormData(prev => ({ ...prev, correctAnswer: option }))}
                                    className="w-4 h-4 text-emerald-600 focus:ring-emerald-500 cursor-pointer"
                                    title="Select as correct answer"
                                />
                            </div>
                            <Input
                                value={option}
                                onChange={(e) => handleOptionChange(index, e.target.value)}
                                placeholder={`Option ${index + 1}`}
                                className={formData.correctAnswer === option && option !== '' ? 'border-emerald-500 ring-1 ring-emerald-500' : ''}
                            />
                            <Button type="button" variant="ghost" size="sm" onClick={() => removeOption(index)} className="text-red-500">
                                <X className="w-4 h-4" />
                            </Button>
                        </div>
                    ))}
                    <Button type="button" variant="outline" size="sm" onClick={addOption} className="mt-2 text-blue-600">
                        <Plus className="w-3 h-3 mr-1" /> Add Option
                    </Button>
                    <p className="text-xs text-gray-500 mt-1">Select the radio button next to an option to mark it as the correct answer.</p>
                </div>
            )}

            {/* True/False Specifics */}
            {formData.type === 'TRUE_FALSE' && (
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Correct Answer</label>
                    <div className="flex gap-4">
                        <label className="flex items-center gap-2 cursor-pointer">
                            <input
                                type="radio"
                                name="correctAnswer"
                                value="true" // Backend likely expects string "true" or "True"
                                checked={formData.correctAnswer?.toLowerCase() === 'true'}
                                onChange={(e) => setFormData(prev => ({ ...prev, correctAnswer: 'True' }))}
                                className="w-4 h-4 text-blue-600"
                            />
                            <span>True</span>
                        </label>
                        <label className="flex items-center gap-2 cursor-pointer">
                            <input
                                type="radio"
                                name="correctAnswer"
                                value="false"
                                checked={formData.correctAnswer?.toLowerCase() === 'false'}
                                onChange={(e) => setFormData(prev => ({ ...prev, correctAnswer: 'False' }))}
                                className="w-4 h-4 text-blue-600"
                            />
                            <span>False</span>
                        </label>
                    </div>
                </div>
            )}

            {/* Short Answer Specifics */}
            {formData.type === 'SHORT_ANSWER' && (
                <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Correct Answer (Keyword/Phrase)</label>
                    <Input
                        name="correctAnswer"
                        value={formData.correctAnswer}
                        onChange={handleChange}
                        placeholder="Expected answer key..."
                        required
                    />
                </div>
            )}

            {/* Explanation */}
            <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Explanation (Optional)</label>
                <textarea
                    name="explanation"
                    value={formData.explanation}
                    onChange={handleChange}
                    rows={2}
                    className="w-full rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Explain why this is the correct answer..."
                />
            </div>

            <div className="pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-end gap-3">
                <Button type="button" variant="outline" onClick={() => router.back()}>Cancel</Button>
                <Button type="submit" variant="primary" disabled={loading}>
                    {loading ? <Loader2 className="w-4 h-4 animate-spin mr-2" /> : <Save className="w-4 h-4 mr-2" />}
                    {isEditing ? 'Update Question' : 'Save Question'}
                </Button>
            </div>
        </form>
    );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\results\ScoreCard.tsx %%%%
'use client';

interface ScoreCardProps {
    score: number;
    totalMarks: number;
    passingMarks?: number;
    className?: string;
}

export function ScoreCard({
    score,
    totalMarks,
    passingMarks,
    className = '',
}: ScoreCardProps) {
    const percentage = totalMarks > 0 ? Math.round((score / totalMarks) * 100) : 0;
    const isPassed = passingMarks ? score >= passingMarks : percentage >= 40;

    const getGrade = () => {
        if (percentage >= 90) return { grade: 'A+', color: 'text-green-600 dark:text-green-400' };
        if (percentage >= 80) return { grade: 'A', color: 'text-green-600 dark:text-green-400' };
        if (percentage >= 70) return { grade: 'B', color: 'text-blue-600 dark:text-blue-400' };
        if (percentage >= 60) return { grade: 'C', color: 'text-yellow-600 dark:text-yellow-400' };
        if (percentage >= 50) return { grade: 'D', color: 'text-orange-600 dark:text-orange-400' };
        return { grade: 'F', color: 'text-red-600 dark:text-red-400' };
    };

    const { grade, color } = getGrade();

    // Calculate stroke dasharray for circular progress
    const radius = 60;
    const circumference = 2 * Math.PI * radius;
    const strokeDashoffset = circumference - (percentage / 100) * circumference;

    return (
        <div className={`bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 ${className}`}>
            <div className="flex flex-col items-center">
                {/* Circular Progress */}
                <div className="relative w-40 h-40 mb-4">
                    <svg className="w-full h-full transform -rotate-90" viewBox="0 0 140 140">
                        {/* Background circle */}
                        <circle
                            cx="70"
                            cy="70"
                            r={radius}
                            stroke="currentColor"
                            strokeWidth="12"
                            fill="none"
                            className="text-gray-200 dark:text-gray-700"
                        />
                        {/* Progress circle */}
                        <circle
                            cx="70"
                            cy="70"
                            r={radius}
                            stroke="currentColor"
                            strokeWidth="12"
                            fill="none"
                            strokeLinecap="round"
                            className={isPassed ? 'text-green-500' : 'text-red-500'}
                            style={{
                                strokeDasharray: circumference,
                                strokeDashoffset,
                                transition: 'stroke-dashoffset 0.5s ease-in-out',
                            }}
                        />
                    </svg>
                    {/* Percentage text */}
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <span className={`text-4xl font-bold ${color}`}>{percentage}%</span>
                        <span className="text-sm text-gray-600 dark:text-gray-300">Score</span>
                    </div>
                </div>

                {/* Grade Badge */}
                <div className={`text-5xl font-bold mb-2 ${color}`}>{grade}</div>

                {/* Score Details */}
                <div className="text-center">
                    <p className="text-lg text-gray-700 dark:text-gray-300">
                        <span className="font-semibold">{score}</span>
                        <span className="text-gray-600 dark:text-gray-300"> / {totalMarks} marks</span>
                    </p>
                    {passingMarks && (
                        <p className="text-sm text-gray-600 dark:text-gray-300 mt-1">
                            Passing marks: {passingMarks}
                        </p>
                    )}
                </div>

                {/* Pass/Fail Badge */}
                <div
                    className={`mt-4 px-4 py-2 rounded-full text-sm font-medium ${isPassed
                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'
                            : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'
                        }`}
                >
                    {isPassed ? '✓ Passed' : '✗ Failed'}
                </div>
            </div>
        </div>
    );
}

export default ScoreCard;


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Badge.tsx %%%%
// components/ui/Badge.tsx - Enhanced Badge Component
'use client';

import React from 'react';
import { motion } from 'framer-motion';

interface BadgeProps {
  children: React.ReactNode;
  variant?: 'default' | 'success' | 'warning' | 'danger' | 'info' | 'purple';
  size?: 'sm' | 'md' | 'lg';
  dot?: boolean;
  pulse?: boolean;
  className?: string;
}

export function Badge({
  children,
  variant = 'default',
  size = 'md',
  dot = false,
  pulse = false,
  className = ''
}: BadgeProps) {
  const variants = {
    default: 'bg-slate-100 text-slate-700 border-slate-200',
    success: 'bg-green-50 text-green-700 border-green-200',
    warning: 'bg-yellow-50 text-yellow-700 border-yellow-200',
    danger: 'bg-red-50 text-red-700 border-red-200',
    info: 'bg-blue-50 text-blue-700 border-blue-200',
    purple: 'bg-purple-50 text-purple-700 border-purple-200',
  };

  const sizes = {
    sm: 'px-2 py-0.5 text-xs',
    md: 'px-2.5 py-1 text-sm',
    lg: 'px-3 py-1.5 text-base',
  };

  const dotColors = {
    default: 'bg-slate-500',
    success: 'bg-green-500',
    warning: 'bg-yellow-500',
    danger: 'bg-red-500',
    info: 'bg-blue-500',
    purple: 'bg-purple-500',
  };

  return (
    <motion.span
      initial={{ scale: 0.8, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      className={`
        inline-flex items-center gap-1.5 font-medium rounded-full border
        ${variants[variant]} ${sizes[size]} ${className}
      `}
    >
      {dot && (
        <span className="relative flex h-2 w-2">
          {pulse && (
            <span className={`animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 ${dotColors[variant]}`} />
          )}
          <span className={`relative inline-flex rounded-full h-2 w-2 ${dotColors[variant]}`} />
        </span>
      )}
      {children}
    </motion.span>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Button.tsx %%%%
// components/ui/Button.tsx
"use client";

import React from 'react';
import { motion, useReducedMotion, MotionProps } from 'framer-motion';
import { Loader2 } from 'lucide-react';

interface ButtonProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, keyof MotionProps> {
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'danger' | 'success' | 'gradient';
  size?: 'sm' | 'md' | 'lg' | 'xl';
  isLoading?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  children: React.ReactNode;
}

export function Button({
  variant = 'primary',
  size = 'md',
  isLoading = false,
  leftIcon,
  rightIcon,
  className = '',
  children,
  disabled,
  ...props
}: ButtonProps) {
  const shouldReduceMotion = useReducedMotion();

  const baseStyles = `
    relative inline-flex items-center justify-center font-semibold
    rounded-xl transition-all duration-200 ease-out
    focus:outline-none focus-visible:ring-4 focus-visible:ring-offset-2
    disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none
    active:scale-95 select-none
    `;

  const variants = {
    primary: `
      bg-gradient-to-r from-blue-600 to-blue-700
      hover:from-blue-700 hover:to-blue-800
      text-white shadow-md hover:shadow-lg hover:-translate-y-0.5
      focus:ring-blue-500 dark:from-blue-500 dark:to-blue-600
    `,
    secondary: `
      bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700
      text-slate-900 dark:text-slate-100 border border-slate-300 dark:border-slate-600
      hover:shadow-md focus:ring-slate-500
    `,
    outline: `
      border-2 border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20
      hover:border-blue-700 focus:ring-blue-500 dark:text-blue-400 dark:border-blue-400
    `,
    ghost: `
      bg-transparent hover:bg-slate-100 dark:hover:bg-slate-800
      text-slate-700 dark:text-slate-300 hover:text-slate-900 dark:hover:text-slate-100
      focus:ring-slate-500
    `,
    danger: `
      bg-gradient-to-r from-red-600 to-red-700
      hover:from-red-700 hover:to-red-800
      text-white shadow-md hover:shadow-lg hover:-translate-y-0.5
      focus:ring-red-500
    `,
    success: `
      bg-gradient-to-r from-green-600 to-green-700
      hover:from-green-700 hover:to-green-800
      text-white shadow-md hover:shadow-lg hover:-translate-y-0.5
      focus:ring-green-500
    `,
    gradient: `
      bg-gradient-to-r from-purple-600 via-pink-600 to-red-600
      hover:from-purple-700 hover:via-pink-700 hover:to-red-700
      text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5
      focus:ring-purple-500 animate-gradient-shift
    `,
  };

  const sizes = {
    sm: 'px-3 py-1.5 text-sm gap-1.5 min-h-[36px]',
    md: 'px-4 py-2 text-base gap-2 min-h-[44px]',
    lg: 'px-6 py-3 text-lg gap-2.5 min-h-[52px]',
    xl: 'px-8 py-4 text-xl gap-3 min-h-[60px]',
  };

  return (
    <motion.button
      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className} ${shouldReduceMotion ? '' : 'hover:scale-105'} `}
      disabled={disabled || isLoading}
      aria-busy={isLoading || undefined}
      whileTap={!shouldReduceMotion && !disabled && !isLoading ? { scale: 0.95 } : undefined}
      transition={{ type: "spring", stiffness: 400, damping: 17 }}
      {...props}
    >
      {isLoading ? (
        <motion.div
          className="flex items-center gap-2"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
        >
          <Loader2 className="w-4 h-4 animate-spin" aria-hidden="true" />
          <span>Loading...</span>
        </motion.div>
      ) : (
        <div className="flex items-center gap-2">
          {leftIcon && (
            <motion.span
              className="flex-shrink-0"
              aria-hidden="true"
              initial={{ x: -10, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
              transition={{ delay: 0.1 }}
            >
              {leftIcon}
            </motion.span>
          )}
          <span>{children}</span>
          {rightIcon && (
            <motion.span
              className="flex-shrink-0"
              aria-hidden="true"
              initial={{ x: 10, opacity: 0 }}
              animate={{ x: 0, opacity: 1 }}
              transition={{ delay: 0.1 }}
            >
              {rightIcon}
            </motion.span>
          )}
        </div>
      )}
    </motion.button>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Card.tsx %%%%
// components/ui/Card.tsx
"use client";

import React from 'react';
import { motion, useReducedMotion, MotionProps } from 'framer-motion';
import { cn } from '@/lib/utils';

interface CardProps extends Omit<React.HTMLAttributes<HTMLDivElement>, keyof MotionProps> {
  hover?: boolean;
  children: React.ReactNode;
}

interface CardHeaderProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

interface CardContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

interface CardTitleProps extends React.HTMLAttributes<HTMLHeadingElement> {
  children: React.ReactNode;
}

interface CardFooterProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function Card({ hover = false, className = '', children, ...props }: CardProps) {
  const shouldReduceMotion = useReducedMotion();

  return (
    <motion.div
      className={cn(
        "rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm",
        hover && !shouldReduceMotion && "hover:shadow-lg hover:-translate-y-1 transition-all duration-300 ease-out",
        shouldReduceMotion && "transition-shadow duration-300",
        className
      )}
      {...props}
    >
      {children}
    </motion.div>
  );
}

export function CardHeader({ className = '', children, ...props }: CardHeaderProps) {
  return (
    <div className={cn("p-6 pb-4", className)} {...props}>
      {children}
    </div>
  );
}

export function CardContent({ className = '', children, ...props }: CardContentProps) {
  return (
    <div className={cn("p-6 pt-0", className)} {...props}>
      {children}
    </div>
  );
}

export function CardTitle({ className = '', children, ...props }: CardTitleProps) {
  return (
    <h3 className={cn('text-lg font-semibold text-gray-900 dark:text-gray-100', className)} {...props}>
      {children}
    </h3>
  );
}

export function CardFooter({ className = '', children, ...props }: CardFooterProps) {
  return (
    <div className={cn("p-6 pt-4 border-t border-gray-100 dark:border-gray-700", className)} {...props}>
      {children}
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\FocusDemo.tsx %%%%
import React from 'react';
import { Button } from './Button';

export default function FocusDemo() {
  return (
    <div className="p-8">
      <h2 className="text-2xl font-semibold mb-4">Focus Indicator Demo</h2>

      <p className="text-sm text-gray-600 mb-6">Use Tab to move focus between elements and see the visible focus rings.</p>

      <div className="flex flex-col gap-4 max-w-lg">
        <div className="flex gap-4 items-center">
          <Button variant="primary">Primary Button</Button>
          <Button variant="outline">Outline</Button>
          <a href="#" className="text-blue-600 hover:underline focus-visible:outline-2 focus-visible:outline-offset-2">Link</a>
        </div>

        <div className="flex gap-4 items-center">
          <input className="p-2 border rounded focus-visible:outline-2 focus-visible:outline-offset-2" placeholder="Text input" />
          <textarea className="p-2 border rounded focus-visible:outline-2 focus-visible:outline-offset-2" placeholder="Textarea" />
        </div>

        <div>
          <p className="text-sm text-gray-500 mb-2">Question palette sample</p>
          <div className="grid grid-cols-5 gap-2">
            {Array.from({ length: 10 }).map((_, i) => (
              <button
                key={i}
                type="button"
                className="aspect-square rounded-md flex items-center justify-center text-sm font-medium border bg-gray-100 focus-visible:outline-2 focus-visible:outline-offset-2"
              >
                {i + 1}
              </button>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Input.tsx %%%%
// components/ui/Input.tsx
"use client";

import React, { forwardRef } from 'react';
import { motion, useReducedMotion, MotionProps } from 'framer-motion';
import { cn } from '@/lib/utils';
import { Eye, EyeOff, AlertCircle, CheckCircle } from 'lucide-react';

interface InputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, keyof MotionProps> {
  label?: string;
  error?: string;
  success?: boolean;
  helperText?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  showPasswordToggle?: boolean;
}

export const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      className = '',
      type = 'text',
      label,
      error,
      success,
      helperText,
      leftIcon,
      rightIcon,
      showPasswordToggle = false,
      disabled,
      ...props
    },
    ref
  ) => {
    const [showPassword, setShowPassword] = React.useState(false);
    const [isFocused, setIsFocused] = React.useState(false);
    const shouldReduceMotion = useReducedMotion();

    const inputType = type === 'password' && showPassword ? 'text' : type;
    const hasError = !!error;
    const hasSuccess = success && !hasError;

    const baseStyles = cn(
      "w-full px-4 py-3 rounded-xl border transition-all duration-200",
      "text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",
      "bg-white dark:bg-gray-800",
      "focus:outline-none focus:ring-2 focus:ring-offset-2",
      "disabled:opacity-60 disabled:cursor-not-allowed",
      leftIcon && "pl-12",
      (rightIcon || showPasswordToggle || hasError || hasSuccess) && "pr-12",
      hasError && "border-red-500 focus:border-red-500 focus:ring-red-500",
      hasSuccess && "border-green-500 focus:border-green-500 focus:ring-green-500",
      !hasError && !hasSuccess && "border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500",
      isFocused && !hasError && !hasSuccess && "shadow-sm",
      disabled && "bg-gray-50 dark:bg-gray-900"
    );

    return (
      <div className="w-full">
        {label && (
          <label className={cn(
            "block text-sm font-medium mb-2",
            hasError ? "text-red-600 dark:text-red-400" : "text-gray-700 dark:text-gray-300"
          )}>
            {label}
          </label>
        )}
        
        <div className="relative">
          {leftIcon && (
            <div className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500">
              {leftIcon}
            </div>
          )}
          
          <motion.input
            type={inputType}
            className={baseStyles}
            ref={ref}
            disabled={disabled}
            onFocus={(e) => {
              setIsFocused(true);
              props.onFocus?.(e);
            }}
            onBlur={(e) => {
              setIsFocused(false);
              props.onBlur?.(e);
            }}
            whileFocus={!shouldReduceMotion ? { scale: 1.02 } : undefined}
            transition={{ type: "spring", stiffness: 400, damping: 17 }}
            {...props}
          />
          
          <div className="absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-1">
            {showPasswordToggle && type === 'password' && (
              <button
                type="button"
                onClick={() => setShowPassword(!showPassword)}
                className="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
                disabled={disabled}
              >
                {showPassword ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
              </button>
            )}
            
            {hasError && (
              <AlertCircle className="w-4 h-4 text-red-500" />
            )}
            
            {hasSuccess && (
              <CheckCircle className="w-4 h-4 text-green-500" />
            )}
            
            {!hasError && !hasSuccess && rightIcon && (
              <div className="text-gray-400 dark:text-gray-500">
                {rightIcon}
              </div>
            )}
          </div>
        </div>
        
        {(error || helperText) && (
          <motion.p
            className={cn(
              "mt-2 text-sm",
              hasError ? "text-red-600 dark:text-red-400" : "text-gray-500 dark:text-gray-400"
            )}
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.2 }}
          >
            {error || helperText}
          </motion.p>
        )}
      </div>
    );
  }
);

Input.displayName = 'Input';


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Modal.tsx %%%%
// components/ui/Modal.tsx
"use client";

import React, { useEffect, useRef } from 'react';
import { motion, AnimatePresence, useReducedMotion } from 'framer-motion';
import { createPortal } from 'react-dom';
import { cn } from '@/lib/utils';
import { X } from 'lucide-react';

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  description?: string;
  children: React.ReactNode;
  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';
  showCloseButton?: boolean;
  closeOnBackdropClick?: boolean;
  closeOnEscape?: boolean;
  className?: string;
}

export function Modal({
  isOpen,
  onClose,
  title,
  description,
  children,
  size = 'md',
  showCloseButton = true,
  closeOnBackdropClick = true,
  closeOnEscape = true,
  className = '',
}: ModalProps) {
  const modalRef = useRef<HTMLDivElement>(null);
  const shouldReduceMotion = useReducedMotion();

  // Handle escape key press
  useEffect(() => {
    if (!closeOnEscape || !isOpen) return;

    const handleEscape = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose();
      }
    };

    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, [closeOnEscape, isOpen, onClose]);

  // Focus management
  useEffect(() => {
    if (!isOpen) return;

    const previousFocus = document.activeElement as HTMLElement;
    modalRef.current?.focus();

    return () => {
      if (previousFocus && previousFocus.focus) {
        previousFocus.focus();
      }
    };
  }, [isOpen]);

  // Prevent body scroll when modal is open
  useEffect(() => {
    if (!isOpen) return;

    document.body.style.overflow = 'hidden';
    return () => {
      document.body.style.overflow = '';
    };
  }, [isOpen]);

  const sizeStyles = {
    sm: 'max-w-md',
    md: 'max-w-lg',
    lg: 'max-w-2xl',
    xl: 'max-w-4xl',
    full: 'max-w-full mx-4',
  };

  const modal = (
    <AnimatePresence>
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* Backdrop */}
          <motion.div
            className="absolute inset-0 bg-black/50 backdrop-blur-sm"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={closeOnBackdropClick ? onClose : undefined}
          />
          
          {/* Modal Content */}
          <motion.div
            ref={modalRef}
            className={cn(
              'relative w-full bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700',
              'focus:outline-none focus:ring-4 focus:ring-blue-500/20',
              sizeStyles[size],
              className
            )}
            initial={{ 
              opacity: 0, 
              scale: shouldReduceMotion ? 1 : 0.9,
              y: shouldReduceMotion ? 0 : 20 
            }}
            animate={{ 
              opacity: 1, 
              scale: 1, 
              y: 0 
            }}
            exit={{ 
              opacity: 0, 
              scale: shouldReduceMotion ? 1 : 0.9,
              y: shouldReduceMotion ? 0 : 20 
            }}
            transition={{ 
              type: 'spring', 
              stiffness: 300, 
              damping: 30,
              duration: shouldReduceMotion ? 0.01 : undefined
            }}
            role="dialog"
            aria-modal="true"
            aria-labelledby={title ? 'modal-title' : undefined}
            aria-describedby={description ? 'modal-description' : undefined}
            tabIndex={-1}
          >
            {/* Header */}
            {(title || showCloseButton) && (
              <div className="flex items-center justify-between p-6 pb-4 border-b border-gray-200 dark:border-gray-700">
                {title && (
                  <h2 id="modal-title" className="text-xl font-semibold text-gray-900 dark:text-white">
                    {title}
                  </h2>
                )}
                {showCloseButton && (
                  <button
                    onClick={onClose}
                    className="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
                    aria-label="Close modal"
                  >
                    <X className="w-5 h-5" />
                  </button>
                )}
              </div>
            )}
            
            {/* Description */}
            {description && (
              <p id="modal-description" className="px-6 pt-2 text-sm text-gray-600 dark:text-gray-400">
                {description}
              </p>
            )}
            
            {/* Content */}
            <div className="px-6 py-4 max-h-[70vh] overflow-y-auto">
              {children}
            </div>
          </motion.div>
        </div>
      )}
    </AnimatePresence>
  );

  // Use portal to render modal at the end of body
  if (typeof document !== 'undefined') {
    return createPortal(modal, document.body);
  }
  return null;
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Skeleton.tsx %%%%
// components/ui/Skeleton.tsx
"use client";

import React from 'react';
import { motion, MotionProps } from 'framer-motion';
import { cn } from '@/lib/utils';

interface SkeletonProps extends Omit<React.HTMLAttributes<HTMLDivElement>, keyof MotionProps> {
  variant?: 'text' | 'circular' | 'rectangular' | 'rounded';
  width?: string | number;
  height?: string | number;
  className?: string;
}

export function Skeleton({
  variant = 'rectangular',
  width,
  height,
  className = '',
  ...props
}: SkeletonProps) {
  const variantStyles = {
    text: 'rounded',
    circular: 'rounded-full',
    rectangular: 'rounded-sm',
    rounded: 'rounded-lg',
  };

  return (
    <motion.div
      className={cn(
        'bg-gray-200 dark:bg-gray-700',
        variantStyles[variant],
        className
      )}
      style={{
        width,
        height,
      }}
      animate={{
        opacity: [0.6, 1, 0.6],
      }}
      transition={{
        duration: 1.5,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
      {...props}
    />
  );
}

// Skeleton Card for loading states
export function SkeletonCard() {
  return (
    <div className="p-6 border border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-gray-800">
      <div className="space-y-4">
        <div className="flex items-center space-x-4">
          <Skeleton variant="circular" width={40} height={40} />
          <div className="flex-1 space-y-2">
            <Skeleton width="60%" height={16} variant="text" />
            <Skeleton width="40%" height={12} variant="text" />
          </div>
        </div>
        <div className="space-y-2">
          <Skeleton height={16} variant="text" />
          <Skeleton height={16} variant="text" />
          <Skeleton width="80%" height={16} variant="text" />
        </div>
      </div>
    </div>
  );
}

// Skeleton Table for loading states
export function SkeletonTable({ rows = 5, columns = 4 }: { rows?: number; columns?: number }) {
  return (
    <div className="overflow-x-auto">
      <div className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        {/* Header */}
        <div className="bg-gray-50 dark:bg-gray-800 px-6 py-3">
          <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>
            {Array.from({ length: columns }).map((_, i) => (
              <Skeleton key={`header-${i}`} height={20} variant="text" />
            ))}
          </div>
        </div>
        
        {/* Rows */}
        {Array.from({ length: rows }).map((_, rowIndex) => (
          <div key={`row-${rowIndex}`} className="bg-white dark:bg-gray-900 px-6 py-4">
            <div className="grid gap-4" style={{ gridTemplateColumns: `repeat(${columns}, 1fr)` }}>
              {Array.from({ length: columns }).map((_, colIndex) => (
                <Skeleton key={`cell-${rowIndex}-${colIndex}`} height={16} variant="text" />
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// Skeleton List for loading states
export function SkeletonList({ items = 5 }: { items?: number }) {
  return (
    <div className="space-y-4">
      {Array.from({ length: items }).map((_, i) => (
        <div key={i} className="flex items-center space-x-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg">
          <Skeleton variant="circular" width={32} height={32} />
          <div className="flex-1 space-y-2">
            <Skeleton width="70%" height={16} variant="text" />
            <Skeleton width="50%" height={14} variant="text" />
          </div>
        </div>
      ))}
    </div>
  );
}

interface SkeletonTextProps extends React.HTMLAttributes<HTMLDivElement> {
  lines?: number;
}

export function SkeletonText({ lines = 3, className = '', ...props }: SkeletonTextProps) {
  return (
    <div className={cn('space-y-2', className)} {...props}>
      {Array.from({ length: lines }).map((_, i) => (
        <Skeleton key={i} variant="text" className="h-3 w-full" />
      ))}
    </div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\table-shell.tsx %%%%
// components/ui/table-shell.tsx
'use client';

import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from './Card';
import { Input } from './Input';
import { Button } from './Button';
import { Skeleton } from './Skeleton';
import { ChevronLeft, ChevronRight, ArrowUp, ArrowDown, Minus } from 'lucide-react';

type SortDirection = 'asc' | 'desc' | null;

export interface TableColumn<T> {
  key: keyof T | string;
  label: string;
  sortable?: boolean;
  align?: 'left' | 'center' | 'right';
  render?: (row: T) => React.ReactNode;
  width?: string;
}

export interface TableShellProps<T> {
  title?: string;
  description?: string;
  columns: TableColumn<T>[];
  data: T[];
  loading?: boolean;
  emptyMessage?: string;
  searchPlaceholder?: string;
  total?: number;
  page?: number;
  pageSize?: number;
  onSearch?: (value: string) => void;
  onPageChange?: (page: number) => void;
  onPageSizeChange?: (size: number) => void;
  sortKey?: string;
  sortDirection?: SortDirection;
  onSortChange?: (key: string, direction: Exclude<SortDirection, null>) => void;
  actionsSlot?: React.ReactNode;
}

const PageButton: React.FC<React.ButtonHTMLAttributes<HTMLButtonElement>> = ({ children, ...props }) => (
  <Button variant="secondary" size="sm" {...props}>
    {children}
  </Button>
);

export function TableShell<T>({
  title,
  description,
  columns,
  data,
  loading = false,
  emptyMessage = 'No records found.',
  searchPlaceholder = 'Search…',
  total,
  page = 0,
  pageSize = 10,
  onSearch,
  onPageChange,
  onPageSizeChange,
  sortKey,
  sortDirection = null,
  onSortChange,
  actionsSlot
}: TableShellProps<T>) {
  const totalPages = total !== undefined ? Math.max(1, Math.ceil(total / pageSize)) : 1;

  const handleSort = (key: string) => {
    if (!onSortChange) return;
    const nextDirection: SortDirection =
      sortKey === key ? (sortDirection === 'asc' ? 'desc' : sortDirection === 'desc' ? null : 'asc') : 'asc';
    if (nextDirection) {
      onSortChange(key, nextDirection);
    }
  };

  const SortIcon = ({ active, direction }: { active: boolean; direction: SortDirection }) => {
    if (!active || !direction) return <Minus className="h-3.5 w-3.5 text-slate-300" />;
    return direction === 'asc' ? (
      <ArrowUp className="h-3.5 w-3.5 text-slate-600" />
    ) : (
      <ArrowDown className="h-3.5 w-3.5 text-slate-600" />
    );
  };

  return (
    <Card className="w-full">
      <CardHeader className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div>
          {title && <CardTitle className="text-lg">{title}</CardTitle>}
          {description && <p className="text-sm text-slate-600">{description}</p>}
        </div>
        <div className="flex gap-2 w-full sm:w-auto">
          {onSearch && (
            <Input
              placeholder={searchPlaceholder}
              className="w-full sm:w-64"
              onChange={(e) => onSearch(e.target.value)}
            />
          )}
          {actionsSlot}
        </div>
      </CardHeader>
      <CardContent className="p-0">
        <div className="overflow-x-auto">
          <table className="min-w-full text-sm text-slate-800">
            <thead className="bg-slate-50 border-b border-slate-100">
              <tr>
                {columns.map((col) => {
                  const isActive = sortKey === col.key;
                  return (
                    <th
                      key={col.key as string}
                      className={`px-4 py-3 text-left font-semibold text-slate-700 ${col.width || ''}`}
                    >
                      <div
                        className={`flex items-center gap-1 ${col.sortable ? 'cursor-pointer select-none' : ''}`}
                        onClick={() => col.sortable && handleSort(col.key as string)}
                      >
                        <span>{col.label}</span>
                        {col.sortable && <SortIcon active={isActive} direction={sortDirection} />}
                      </div>
                    </th>
                  );
                })}
              </tr>
            </thead>
            <tbody>
              {loading
                ? Array.from({ length: 5 }).map((_, idx) => (
                    <tr key={idx} className="border-b border-slate-100">
                      {columns.map((col) => (
                        <td key={col.key as string} className="px-4 py-3">
                          <Skeleton className="h-4 w-full" />
                        </td>
                      ))}
                    </tr>
                  ))
                : data.length === 0
                  ? (
                    <tr>
                      <td colSpan={columns.length} className="px-4 py-10 text-center text-slate-300 dark:text-slate-300">
                        {emptyMessage}
                      </td>
                    </tr>
                    )
                  : (
                    data.map((row, idx) => (
                      <tr key={idx} className="border-b border-slate-100 hover:bg-slate-50/70">
                        {columns.map((col) => (
                          <td
                            key={col.key as string}
                            className={`px-4 py-3 ${col.align === 'right' ? 'text-right' : col.align === 'center' ? 'text-center' : 'text-left'}`}
                          >
                            {col.render ? col.render(row) : (row as any)[col.key]}
                          </td>
                        ))}
                      </tr>
                    ))
                    )
              }
            </tbody>
          </table>
        </div>
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 py-4">
          <div className="text-sm text-slate-600">
            {total !== undefined ? `Showing ${data.length} of ${total}` : `Showing ${data.length} items`}
          </div>
          <div className="flex items-center gap-2">
            {onPageSizeChange && (
              <select
                className="border rounded-lg px-2 py-1 text-sm"
                value={pageSize}
                onChange={(e) => onPageSizeChange(Number(e.target.value))}
              >
                {[10, 20, 50].map((size) => (
                  <option key={size} value={size}>
                    {size} / page
                  </option>
                ))}
              </select>
            )}
            <div className="flex items-center gap-1">
              <PageButton
                disabled={page <= 0}
                onClick={() => onPageChange && onPageChange(Math.max(0, page - 1))}
                aria-label="Previous page"
              >
                <ChevronLeft className="h-4 w-4" />
              </PageButton>
              <span className="text-sm text-slate-700 px-2">
                Page {page + 1} / {totalPages}
              </span>
              <PageButton
                disabled={page + 1 >= totalPages}
                onClick={() => onPageChange && onPageChange(Math.min(totalPages - 1, page + 1))}
                aria-label="Next page"
              >
                <ChevronRight className="h-4 w-4" />
              </PageButton>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}



%%%% FILE: D:\projects\oerms\oerms-frontend\components\ui\Toast.tsx %%%%
// components/ui/Toast.tsx
"use client";

import React, { createContext, useContext, useState, useCallback, useEffect } from 'react';
import { motion, AnimatePresence, useReducedMotion } from 'framer-motion';
import { cn } from '@/lib/utils';
import { X, CheckCircle, AlertCircle, AlertTriangle, Info } from 'lucide-react';

type ToastType = 'success' | 'error' | 'warning' | 'info';

interface Toast {
  id: string;
  type: ToastType;
  title: string;
  description?: string;
  duration?: number;
  action?: {
    label: string;
    onClick: () => void;
  };
}

interface ToastContextType {
  toast: (toast: Omit<Toast, 'id'>) => string;
  dismiss: (id: string) => void;
  addToast: (message: string, type?: ToastType, description?: string, duration?: number) => string;
}

const ToastContext = createContext<ToastContextType | undefined>(undefined);

export function useToast() {
  const context = useContext(ToastContext);
  if (!context) {
    throw new Error('useToast must be used within a ToastProvider');
  }
  return context;
}

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const toast = useCallback((toastData: Omit<Toast, 'id'>) => {
    const id = Math.random().toString(36).substr(2, 9);
    const newToast: Toast = { ...toastData, id, duration: toastData.duration || 5000 };
    
    setToasts(prev => [...prev, newToast]);
    
    if (newToast.duration !== Infinity) {
      setTimeout(() => {
        dismiss(id);
      }, newToast.duration);
    }
    
    return id;
  }, []);

  const dismiss = useCallback((id: string) => {
    setToasts(prev => prev.filter(toast => toast.id !== id));
  }, []);

  const addToast = useCallback((message: string, type: ToastType = 'info', description?: string, duration?: number) => {
    return toast({ title: message, type, description, duration });
  }, [toast]);

  return (
    <ToastContext.Provider value={{ toast, dismiss, addToast }}>
      {children}
      <ToastContainer toasts={toasts} onDismiss={dismiss} />
    </ToastContext.Provider>
  );
}

function ToastContainer({ toasts, onDismiss }: { toasts: Toast[]; onDismiss: (id: string) => void }) {
  const shouldReduceMotion = useReducedMotion() || false;

  return (
    <div className="fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full">
      <AnimatePresence>
        {toasts.map((toast) => (
          <ToastItem
            key={toast.id}
            toast={toast}
            onDismiss={onDismiss}
            shouldReduceMotion={shouldReduceMotion}
          />
        ))}
      </AnimatePresence>
    </div>
  );
}

function ToastItem({ toast, onDismiss, shouldReduceMotion }: { toast: Toast; onDismiss: (id: string) => void; shouldReduceMotion: boolean }) {
  const [isHovered, setIsHovered] = useState(false);

  useEffect(() => {
    if (isHovered && toast.duration !== Infinity) {
      // Pause auto-dismiss when hovered
      return;
    }
  }, [isHovered, toast.duration]);

  const icons = {
    success: <CheckCircle className="w-5 h-5 text-green-500" />,
    error: <AlertCircle className="w-5 h-5 text-red-500" />,
    warning: <AlertTriangle className="w-5 h-5 text-yellow-500" />,
    info: <Info className="w-5 h-5 text-blue-500" />,
  };

  const backgrounds = {
    success: 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800',
    error: 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800',
    warning: 'bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800',
    info: 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800',
  };

  return (
    <motion.div
      className={cn(
        "relative p-4 rounded-xl border shadow-lg backdrop-blur-sm",
        "max-w-sm w-full",
        backgrounds[toast.type]
      )}
      initial={{ opacity: 0, x: 100, scale: 0.9 }}
      animate={{ opacity: 1, x: 0, scale: 1 }}
      exit={{ opacity: 0, x: 100, scale: 0.9 }}
      transition={{ 
        type: "spring", 
        stiffness: 400, 
        damping: 25,
        duration: shouldReduceMotion ? 0.01 : undefined
      }}
      layout
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className="flex items-start gap-3">
        <div className="flex-shrink-0 mt-0.5">
          {icons[toast.type]}
        </div>
        
        <div className="flex-1 min-w-0">
          <h4 className="text-sm font-semibold text-gray-900 dark:text-gray-100">
            {toast.title}
          </h4>
          
          {toast.description && (
            <p className="mt-1 text-sm text-gray-600 dark:text-gray-400">
              {toast.description}
            </p>
          )}
          
          {toast.action && (
            <button
              onClick={toast.action.onClick}
              className="mt-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"
            >
              {toast.action.label}
            </button>
          )}
        </div>
        
        <button
          onClick={() => onDismiss(toast.id)}
          className="flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Dismiss notification"
        >
          <X className="w-4 h-4" />
        </button>
      </div>
      
      {/* Progress bar */}
      {toast.duration !== Infinity && !isHovered && (
        <motion.div
          className="absolute bottom-0 left-0 h-1 bg-gray-300 dark:bg-gray-600 rounded-b-xl origin-left"
          initial={{ scaleX: 1 }}
          animate={{ scaleX: 0 }}
          transition={{ 
            duration: (toast.duration || 5000) / 1000,
            ease: "linear"
          }}
        />
      )}
    </motion.div>
  );
}


%%%% FILE: D:\projects\oerms\oerms-frontend\export-to-tex.js %%%%
// save this as export-to-tex.js in your project root
// run with: node export-to-tex.js

const fs = require("fs");
const path = require("path");

// configure which file types you want to include
const extensions = [".js", ".ts", ".tsx", ".json", ".css"];

const outputFile = "project.tex";

// helper: recursively walk through directories
function walk(dir, fileList = []) {
  const files = fs.readdirSync(dir);
  files.forEach((file) => {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);
    if (stat.isDirectory()) {
      walk(filePath, fileList);
    } else if (extensions.includes(path.extname(file))) {
      fileList.push(filePath);
    }
  });
  return fileList;
}

// main
function exportProject() {
  const projectRoot = process.cwd();
  const files = walk(projectRoot);

  fs.writeFileSync(outputFile, ""); // clear old file

  files.forEach((file) => {
    const content = fs.readFileSync(file, "utf8");
    fs.appendFileSync(
      outputFile,
      `%%%% FILE: ${file} %%%%\n${content}\n\n`
    );
  });

  console.log(`✅ Exported ${files.length} files into ${outputFile}`);
}

exportProject();


%%%% FILE: D:\projects\oerms\oerms-frontend\hooks\useAuth.ts %%%%
// hooks/useAuth.ts
"use client";

import { useEffect, useState } from 'react';
import { getCurrentUser, logout, storeTokens, clearTokens, type UserInfo } from '@/lib/auth';
import type { UserRole } from '@/lib/types';

export function useAuth() {
  const [user, setUser] = useState<UserInfo | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const initializeAuth = async () => {
      setIsLoading(true);
      try {
        // Check if user is authenticated by getting current user
        const authenticated = await getCurrentUser();
        setIsAuthenticated(authenticated);
        
        if (authenticated) {
          const userInfo = await getCurrentUser();
          setUser(userInfo);
        }
      } catch (error) {
        console.error('Auth initialization failed:', error);
      } finally {
        setIsLoading(false);
      }
    };

    initializeAuth();
  }, []);

  const login = async (credentials: { email: string; password: string }) => {
    setIsLoading(true);
    try {
      // This would normally call your login API
      // For now, we'll simulate a successful login
      const mockUser: UserInfo = {
        id: '1',
        email: credentials.email,
        username: credentials.email.split('@')[0],
        firstName: 'John',
        lastName: 'Doe',
        roles: ['USER'],
        avatar: '/images/default-avatar.png'
      };
      
      storeTokens('mock-access-token', 'mock-refresh-token', 3600);
      setUser(mockUser);
      setIsAuthenticated(true);
      
      console.log('User logged in successfully');
    } catch (error) {
      console.error('Login failed:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const logout = async () => {
    setIsLoading(true);
    try {
      clearTokens();
      setUser(null);
      setIsAuthenticated(false);
      console.log('User logged out successfully');
    } catch (error) {
      console.error('Logout failed:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const hasRole = (role: UserRole): boolean => {
    if (!user || !user.roles) return false;
    return user.roles.includes(role) || user.roles.includes(`ROLE_${role}`);
  };

  const hasAnyRole = (roles: UserRole[]): boolean => {
    if (!user || !user.roles) return false;
    return roles.some(role => hasRole(role));
  };

  const getDisplayName = (): string => {
    if (!user) return 'Guest';
    return user.firstName 
      ? `${user.firstName} ${user.lastName}`
      : user.username || user.email || 'User';
  };

  return {
    user,
    isAuthenticated,
    isLoading,
    login,
    logout,
    hasRole,
    hasAnyRole,
    getDisplayName,
  };
};

// Default export for compatibility
export default useAuth;


%%%% FILE: D:\projects\oerms\oerms-frontend\hooks\usePolicy.ts %%%%
import { useState, useEffect, useCallback } from 'react';
import { apiClient } from '@/lib/api';
import { useAuth } from '@/hooks/useAuth';

interface UsePolicyResult {
  allowed: boolean;
  loading: boolean;
  error: string | null;
  checkPolicy: () => Promise<void>;
}

export function usePolicy(action: string, resource: string, context?: Record<string, any>): UsePolicyResult {
  const { isAuthenticated } = useAuth();
  const [allowed, setAllowed] = useState(false);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const checkPolicy = useCallback(async () => {
    if (!isAuthenticated) {
      setAllowed(false);
      setLoading(false);
      return;
    }

    setLoading(true);
    setError(null);

    try {
      const response = await apiClient.evaluatePolicy({
        action,
        resource,
        context
      });
      setAllowed(response.allowed);
    } catch (err) {
      console.error('Policy evaluation failed:', err);
      setError('Failed to evaluate policy');
      setAllowed(false);
    } finally {
      setLoading(false);
    }
  }, [isAuthenticated, action, resource, JSON.stringify(context)]);

  useEffect(() => {
    checkPolicy();
  }, [checkPolicy]);

  return { allowed, loading, error, checkPolicy };
}

%%%% FILE: D:\projects\oerms\oerms-frontend\hooks\useProfile.ts %%%%
// hooks/useProfile.ts
import { useState, useEffect } from 'react';
import { UserProfile, ApiError } from '@/lib/types';
import { apiClient } from '@/lib/api';
import { useAuth } from './useAuth';

export function useProfile() {
  const { user, isAuthenticated } = useAuth();
  const [profile, setProfile] = useState<UserProfile | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<ApiError | null>(null);

  useEffect(() => {
    if (!isAuthenticated || !user) {
      setIsLoading(false);
      return;
    }

    let retries = 0;
    const maxRetries = 3;

    const fetchProfile = async () => {
      try {
        console.log('useProfile: Fetching profile data...');
        const response = await apiClient.getMyProfile();
        console.log('useProfile: Raw API response:', response);

        // Extract the data property from the API response
        const data = response?.data || response;
        console.log('useProfile: Extracted data:', data);

        setProfile(data);
        setError(null);
        console.log('useProfile: Profile state set successfully');
      } catch (err) {
        const apiError = err as ApiError;
        
        // Profile might not exist yet (404) - retry with backoff
        if (apiError.status === 404 && retries < maxRetries) {
          retries++;
          setTimeout(fetchProfile, 1000 * retries); // Exponential backoff
          return;
        }
        
        setError(apiError);
      } finally {
        setIsLoading(false);
      }
    };

    fetchProfile();
  }, [isAuthenticated, user]);

  const updateProfile = async (data: Partial<UserProfile>) => {
    if (!user) throw new Error('User not authenticated');
    
    setIsLoading(true);
    try {
      const updated = await apiClient.updateMyProfile(data as any);
      setProfile(updated);
      return updated;
    } catch (err) {
      setError(err as ApiError);
      throw err;
    } finally {
      setIsLoading(false);
    }
  };

  const uploadPicture = async (file: File) => {
    if (!user) throw new Error('User not authenticated');
    
    try {
      const result = await apiClient.uploadMyProfilePicture(file);
      setProfile(prev => prev ? { ...prev, profilePictureUrl: result.fileUrl } : null);
      return result;
    } catch (err) {
      setError(err as ApiError);
      throw err;
    }
  };

  const deletePicture = async () => {
    if (!user) throw new Error('User not authenticated');
    
    try {
      await apiClient.deleteMyProfilePicture();
      setProfile(prev => prev ? { ...prev, profilePictureUrl: undefined } : null);
    } catch (err) {
      setError(err as ApiError);
      throw err;
    }
  };

  const updateInstitution = async (institution: string) => {
    if (!user) throw new Error('User not authenticated');
    
    try {
      await apiClient.updateMyInstitution(institution);
      setProfile(prev => prev ? { ...prev, institution } : null);
    } catch (err) {
      setError(err as ApiError);
      throw err;
    }
  };

  const isProfileComplete = () => {
    if (!profile) return false;
    return !!(
      profile.firstName &&
      profile.lastName &&
      profile.city &&
      profile.institution
    );
  };

  return {
    profile,
    isLoading,
    error,
    updateProfile,
    uploadPicture,
    deletePicture,
    updateInstitution,
    isProfileComplete,
    refetch: () => {
      setIsLoading(true);
      // Trigger re-fetch
    },
  };
}


%%%% FILE: D:\projects\oerms\oerms-frontend\jest.config.js %%%%
const nextJest = require('next/jest');

const createJestConfig = nextJest({ dir: './' });

const customJestConfig = {
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testEnvironment: 'jest-environment-jsdom',
  moduleNameMapper: { '^@/(.*)$': '<rootDir>/$1' },
  collectCoverageFrom: [
    'app/**/*.{js,jsx,ts,tsx}',
    'components/**/*.{js,jsx,ts,tsx}',
    'hooks/**/*.{js,jsx,ts,tsx}',
    'lib/**/*.{js,jsx,ts,tsx}',
    '!**/*.d.ts',
    '!**/node_modules/**'
  ]
};

module.exports = createJestConfig(customJestConfig);


%%%% FILE: D:\projects\oerms\oerms-frontend\jest.setup.js %%%%
import '@testing-library/jest-dom';


%%%% FILE: D:\projects\oerms\oerms-frontend\lib\api\attempt.ts %%%%
import { apiClient } from './client';
import type {
  AttemptResponse,
  SaveAnswerRequest,
  SubmitAttemptRequest,
  AttemptAnswerResponse,
  AttemptSummary,
  ExamAttemptStatistics,
  StartAttemptRequest,
  PageResponse,
  AttemptResultResponse,
  ApiResponse
} from '@/lib/types';

export const attemptService = {

  // =====================
  // Student
  // =====================

  startAttempt(request: StartAttemptRequest) {
    return apiClient.post<AttemptResponse>(
      '/api/attempts/start',
      request
    );
  },

  saveAnswer(attemptId: string, request: SaveAnswerRequest) {
    return apiClient.post<AttemptAnswerResponse>(
      `/api/attempts/${attemptId}/answers`,
      request
    );
  },

  submitAttempt(request: SubmitAttemptRequest) {
    return apiClient.post<AttemptResponse>(
      '/api/attempts/submit',
      request
    );
  },

  getAttempt(attemptId: string) {
    return apiClient.get<AttemptResponse>(
      `/api/attempts/${attemptId}`
    );
  },

  getAttemptAnswers(attemptId: string) {
    return apiClient.get<AttemptAnswerResponse[]>(
      `/api/attempts/${attemptId}/answers`
    );
  },

  getAttemptResultDetails(attemptId: string) {
    return apiClient.get<AttemptResultResponse>(
      `/api/attempts/${attemptId}/result-details`
    );
  },

  getMyAttempts(page = 0, size = 20) {
    return apiClient.get<PageResponse<AttemptSummary>>(
      `/api/attempts/my-attempts?page=${page}&size=${size}`
    );
  },

  getMyExamAttempts(examId: string, page = 0, size = 20) {
    return apiClient.get<PageResponse<AttemptSummary>>(
      `/api/attempts/my-attempts/exam/${examId}?page=${page}&size=${size}`
    );
  },

  getMyAttemptsCount() {
    return apiClient.get<number>(
      '/api/attempts/my-attempts/count'
    );
  },

  // =====================
  // Proctoring
  // =====================

  recordTabSwitch(attemptId: string) {
    return apiClient.post<void>(
      `/api/attempts/${attemptId}/tab-switch`
    );
  },

  recordWebcamViolation(attemptId: string) {
    return apiClient.post<void>(
      `/api/attempts/${attemptId}/webcam-violation`
    );
  },

  recordCustomViolation(attemptId: string, violationType: string) {
    return apiClient.post<void>(
      `/api/attempts/${attemptId}/violations/custom?violationType=${encodeURIComponent(violationType)}`
    );
  },

  // =====================
  // Teacher / Admin
  // =====================

  getExamAttempts(examId: string, page = 0, size = 20) {
    return apiClient.get<PageResponse<AttemptSummary>>(
      `/api/attempts/exam/${examId}?page=${page}&size=${size}`
    );
  },

  getExamAttemptStatistics(examId: string) {
    return apiClient.get<ExamAttemptStatistics>(
      `/api/attempts/exam/${examId}/statistics`
    );
  },

  getExamAttemptsCount(examId: string) {
    return apiClient.get<number>(
      `/api/attempts/exam/${examId}/count`
    );
  },

  getStudentAttempts(studentId: string, page = 0, size = 20) {
    return apiClient.get<PageResponse<AttemptSummary>>(
      `/api/attempts/student/${studentId}?page=${page}&size=${size}`
    );
  },

  getAllAttempts(page = 0, size = 20) {
    return apiClient.get<PageResponse<AttemptSummary>>(
      `/api/attempts/all?page=${page}&size=${size}`
    );
  },

  health() {
    return apiClient.get<string>(
      '/api/attempts/health'
    );
  }
};


%%%% FILE: D:\projects\oerms\oerms-frontend\lib\api\auth.ts %%%%
// lib/api/auth.ts - Authentication service

import { apiClient } from './client';
import type { UserResponse, RegisterRequest } from '@/lib/types';

export const authService = {
  /**
   * Get current authenticated user info
   */
  async getCurrentUser(): Promise<UserResponse> {
    return apiClient.get<UserResponse>('/api/auth/me');
  },

  /**
   * Register new user
   */
  async register(data: RegisterRequest): Promise<{ user: UserResponse; redirectUrl: string }> {
    return apiClient.post<{ user: UserResponse; redirectUrl: string }>('/api/auth/register', data);
  },

  /**
   * Assign role to user (Admin only)
   */
  async assignRole(userId: string, role: 'STUDENT' | 'TEACHER' | 'ADMIN'): Promise<UserResponse> {
    return apiClient.post<UserResponse>(`/api/auth/roles/${userId}/assign/${role}`);
  },

  /**
   * Remove role from user (Admin only)
   */
  async removeRole(userId: string, role: 'STUDENT' | 'TEACHER' | 'ADMIN'): Promise<UserResponse> {
    return apiClient.delete<UserResponse>(`/api/auth/roles/${userId}/remove/${role}`);
  },

  /**
   * Get user by ID (Admin only)
   * Uses /api/admin/users/{id} endpoint
   */
  async getUser(userId: string): Promise<UserResponse> {
    return apiClient.get<UserResponse>(`/api/admin/users/${userId}`);
  },

  /**
   * Get all users (Admin only)
   * Uses /api/admin/users endpoint
   */
  async getAllUsers(params?: { page?: number; size?: number; sortBy?: string; sortDir?: string }): Promise<any> {
    const queryParams = new URLSearchParams();
    if (params?.page !== undefined) queryParams.append('page', params.page.toString());
    if (params?.size !== undefined) queryParams.append('size', params.size.toString());
    if (params?.sortBy) queryParams.append('sortBy', params.sortBy);
    if (params?.sortDir) queryParams.append('sortDir', params.sortDir);

    return apiClient.get(`/api/admin/users?${queryParams.toString()}`);
  },

  /**
   * Delete user (Admin only)
   * Uses /api/admin/users/{id} endpoint
   */
  async deleteUser(userId: string): Promise<void> {
    await apiClient.delete(`/api/admin/users/${userId}`);
  },

  /**
   * Enable user account (Admin only)
   * Uses /api/admin/users/{id}/enable endpoint
   */
  async enableUser(userId: string): Promise<UserResponse> {
    return apiClient.put<UserResponse>(`/api/admin/users/${userId}/enable`);
  },

  /**
   * Disable user account (Admin only)
   * Uses /api/admin/users/{id}/disable endpoint
   */
  async disableUser(userId: string): Promise<UserResponse> {
    return apiClient.put<UserResponse>(`/api/admin/users/${userId}/disable`);
  },

  /**
   * Lock user account (Admin only)
   * Uses /api/admin/users/{id}/lock endpoint
   */
  async lockUser(userId: string): Promise<UserResponse> {
    return apiClient.put<UserResponse>(`/api/admin/users/${userId}/lock`);
  },

  /**
   * Unlock user account (Admin only)
   * Uses /api/admin/users/{id}/unlock endpoint
   */
  async unlockUser(userId: string): Promise<UserResponse> {
    return apiClient.put<UserResponse>(`/api/admin/users/${userId}/unlock`);
  }
};


%%%% FILE: D:\projects\oerms\oerms-frontend\lib\api\client.ts %%%%
// lib/api/client.ts - Base API client with Bearer token authentication

// Use relative URLs to go through Next.js proxy
const BASE_URL = '';
const FRONTEND_URL = process.env.NEXT_PUBLIC_FRONTEND_URL || 'http://localhost:3000';

// Import auth functions
const getAccessToken = async (): Promise<string | null> => {
  if (typeof window === 'undefined') return null;
  try {
    // Import dynamically to avoid circular dependency
    const { getAccessToken: getToken } = await import('../auth');
    return await getToken();
  } catch {
    return null;
  }
};

export interface ApiResponse<T> {
  success: boolean;
  message: string;
  data: T;
  timestamp: string;
  path: string;
}

export interface ApiError {
  message: string;
  status: number;
  details?: any;
}

class APIClient {
  private baseUrl: string;

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl;
  }

  private async handleResponse<T>(response: Response): Promise<T> {
    if (!response.ok) {
      // Handle 401 (Unauthorized) - don't try to refresh since no refresh endpoint exists
      if (response.status === 401) {
        // Redirect to login on authentication failure
        if (typeof window !== 'undefined') {
          window.location.href = '/login';
        }
        throw new Error('Authentication required');
      }

      // Handle other errors
      const errorData = await response.json().catch(() => ({ message: 'Request failed' }));
      const error: ApiError = {
        message: errorData.message || `Request failed with status ${response.status}`,
        status: response.status,
        details: errorData
      };
      throw error;
    }

    const result: ApiResponse<T> = await response.json();
    return result.data;
  }

  async get<T>(path: string, options?: RequestInit): Promise<T> {
    const token = await getAccessToken();
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      'Origin': FRONTEND_URL,
      ...(options?.headers as Record<string, string> || {})
    };

    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(`${this.baseUrl}${path}`, {
      ...options,
      method: 'GET',
      headers
    });

    return this.handleResponse<T>(response);
  }

  async post<T>(path: string, data?: any, options?: RequestInit): Promise<T> {
    const token = await getAccessToken();
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      'Origin': FRONTEND_URL,
      ...(options?.headers as Record<string, string> || {})
    };

    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(`${this.baseUrl}${path}`, {
      ...options,
      method: 'POST',
      headers,
      body: data ? JSON.stringify(data) : undefined
    });

    return this.handleResponse<T>(response);
  }

  async put<T>(path: string, data?: any, options?: RequestInit): Promise<T> {
    const token = await getAccessToken();
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      'Origin': FRONTEND_URL,
      ...(options?.headers as Record<string, string> || {})
    };

    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(`${this.baseUrl}${path}`, {
      ...options,
      method: 'PUT',
      headers,
      body: data ? JSON.stringify(data) : undefined
    });

    return this.handleResponse<T>(response);
  }

  async delete<T>(path: string, options?: RequestInit): Promise<T> {
    const token = await getAccessToken();
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      'Origin': FRONTEND_URL,
      ...(options?.headers as Record<string, string> || {})
    };

    if (token) {
      headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(`${this.baseUrl}${path}`, {
      ...options,
      method: 'DELETE',
      headers
    });

    return this.handleResponse<T>(response);
  }
}

export const apiClient = new APIClient(BASE_URL);